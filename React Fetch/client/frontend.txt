----- FILE: .\src\auth\AdminRoute.jsx -----

import { Navigate } from "react-router-dom";
import { useRole } from "./RoleContext";

export default function AdminRoute({ children }) {
  const { role } = useRole();
  return role === "ADMIN" ? children : <Navigate to="/" replace />;
}

----- FILE: .\src\auth\RoleContext.jsx -----
import { createContext, useContext, useMemo, useState } from "react";

const RoleCtx = createContext();

export function RoleProvider({ children }) {
  const [role, setRole] = useState(
    localStorage.getItem("role") || "USER"
  );
  const toggle = () => {
    const next = role === "ADMIN" ? "USER" : "ADMIN";
    setRole(next);
    localStorage.setItem("role", next);
  };
  const value = useMemo(() => ({ role, setRole, toggle }), [role]);
  return <RoleCtx.Provider value={value}>{children}</RoleCtx.Provider>;
}

export const useRole = () => useContext(RoleCtx);

----- FILE: .\src\auth\RoleToggle.jsx -----
import { useRole } from "./RoleContext.jsx";

export default function RoleToggle() {
  const { role, toggle } = useRole();
  return (
    <button
      onClick={toggle}
      className="rounded-md border px-3 py-2 text-sm"
      title="Alternar rol"
    >
      {role === "ADMIN" ? "Vista Admin" : "Vista Usuario"}
    </button>
  );
}

----- FILE: .\src\components\Filters.jsx -----
export default function Filters() {
  return (
    <aside className="sticky top-24 rounded-xl border border-stone-800 bg-[#20160F] p-6 h-fit">
      <h2 className="text-2xl font-bold text-stone-100">Filtros</h2>

      <div className="mt-4 space-y-6">
        <section>
          <h3 className="text-sm font-semibold text-stone-300 mb-2">Marca</h3>
          <div className="space-y-2">
            {["Harmony", "Silver Creek", "Blue Ridge", "Recording King"].map((m) => (
              <label key={m} className="flex items-center gap-2 text-stone-300">
                <input
                  type="checkbox"
                  className="h-4 w-4 rounded border-stone-600 bg-transparent text-amber-500 focus:ring-amber-500"
                  defaultChecked={m === "Blue Ridge"}
                />
                <span className="text-sm">{m}</span>
              </label>
            ))}
          </div>
        </section>

        <section>
          <h3 className="text-sm font-semibold text-stone-300 mb-2">Tipo de Madera</h3>
          <div className="space-y-2 text-stone-300 text-sm">
            {["Caoba", "Abeto", "Palosanto"].map((m) => (
              <label key={m} className="flex items-center gap-2">
                <input type="checkbox" className="h-4 w-4 rounded border-stone-600 bg-transparent text-amber-500 focus:ring-amber-500" />
                {m}
              </label>
            ))}
          </div>
        </section>

        <section>
          <h3 className="text-sm font-semibold text-stone-300 mb-2">Color</h3>
          <div className="space-y-2 text-stone-300 text-sm">
            {["Natural", "Sunburst", "Negro"].map((c) => (
              <label key={c} className="flex items-center gap-2">
                <input type="checkbox" className="h-4 w-4 rounded border-stone-600 bg-transparent text-amber-500 focus:ring-amber-500" />
                {c}
              </label>
            ))}
          </div>
        </section>

        <section>
          <h3 className="text-sm font-semibold text-stone-300 mb-2">Rango de Precios</h3>
          <input
            type="range"
            min="100"
            max="3000"
            defaultValue="800"
            className="h-1.5 w-full cursor-pointer appearance-none rounded-full bg-stone-700"
          />
          <div className="mt-2 flex justify-between text-xs text-stone-500">
            <span>$100</span>
            <span>$3000</span>
          </div>
        </section>
      </div>
    </aside>
  );
}

----- FILE: .\src\components\Footer.jsx -----
import { Link } from "react-router-dom";

export default function Footer() {
  return (
    <footer className="mt-16 border-t border-primary/20 bg-background-light dark:border-primary/30 dark:bg-background-dark">
      <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
        <nav className="flex flex-wrap justify-center gap-x-8 gap-y-4 text-center">
          <Link
            className="text-sm text-stone-600 hover:text-primary dark:text-stone-400 dark:hover:text-primary"
            to="/catalog"
          >
            Tienda
          </Link>
          <Link
             className="text-sm text-stone-600 hover:text-primary dark:text-stone-400 dark:hover:text-primary"
             to="/faq"
>
  Preguntas Frecuentes
</Link>


          <Link
            className="text-sm text-stone-600 hover:text-primary dark:text-stone-400 dark:hover:text-primary"
            to="/about"
          >
            Sobre Nosotros
          </Link>

          <Link
            className="text-sm text-stone-600 hover:text-primary dark:text-stone-400 dark:hover:text-primary"
            to="/contact"
          >
            Contacto
          </Link>
        </nav>

        <p className="mt-8 text-center text-sm text-stone-500 dark:text-stone-500">
          Â© {new Date().getFullYear()} String &amp; Soul. Todos los derechos reservados.
        </p>
      </div>
    </footer>
  );
}

----- FILE: .\src\components\NavBar.jsx -----
import { Link, useNavigate } from "react-router-dom";
import { useState } from "react";
import { useShop } from "../context/ShopContext.jsx";
import { useAuth } from "../context/AuthContext.jsx";

export default function NavBar() {
  const [query, setQuery] = useState("");
  const navigate = useNavigate();
  const { state } = useShop();
  const { isAuth, user, logout } = useAuth();

  const count = (state?.cart ?? []).reduce((n, it) => n + (it.qty ?? it.quantity ?? 1), 0);

  const handleSearch = (e) => {
    e.preventDefault();
    const q = query.trim();
    if (q) navigate(`/search?q=${encodeURIComponent(q)}`);
  };

  const handleLogout = () => {
    logout();
    navigate("/");
  };

  return (
    <header className="fixed inset-x-0 top-0 z-50 border-b border-stone-200 bg-background-light/80 backdrop-blur-sm dark:border-stone-800 dark:bg-background-dark/80">
      <div className="mx-auto flex max-w-8xl items-center justify-between px-4 py-3 sm:px-6 lg:px-8">
        <Link to="/" className="flex items-center gap-3">
          <svg className="h-6 w-6 text-primary" fill="currentColor" viewBox="0 0 24 24">
            <path d="M14.25 2.25a.75.75 0 0 0-.75.75v18a.75.75 0 0 0 .75.75h4.5a.75.75 0 0 0 .75-.75V3a.75.75 0 0 0-.75-.75h-4.5ZM15 3.75h3v16.5h-3V3.75Z" />
            <path d="M4.5 3.75a.75.75 0 0 0-.75.75v15a.75.75 0 0 0 .75.75h4.5a.75.75 0 0 0 .75-.75V4.5a.75.75 0 0 0-.75-.75h-4.5ZM5.25 5.25h3v13.5h-3V5.25Z" />
          </svg>
          <h1 className="text-xl font-bold text-stone-900 dark:text-white">String &amp; Soul</h1>
        </Link>

        <nav className="flex gap-10">
          <Link to="/catalog" className="text-sm font-medium text-white hover:text-primary">CatÃ¡logo</Link>
          <Link to="/catalog?cat=electric" className="text-sm font-medium text-white hover:text-primary">Electric</Link>
          <Link to="/catalog?cat=acoustic" className="text-sm font-medium text-white hover:text-primary">Acoustic</Link>
          <Link to="/catalog?cat=bass" className="text-sm font-medium text-white hover:text-primary">Bass</Link>
          {/* ya no mostramos botÃ³n Admin ni toggle de rol */}
        </nav>

        <div className="flex items-center gap-3">
          <form onSubmit={handleSearch} className="relative w-44 sm:w-52 lg:w-64">
            <input
              type="text"
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              placeholder="Buscar guitarras..."
              className="w-full rounded-md border border-stone-300 bg-transparent py-1.5 pl-9 pr-3 text-sm text-stone-800 placeholder-stone-500 focus:border-primary focus:ring-1 focus:ring-primary dark:border-stone-700 dark:text-white dark:placeholder-stone-400"
            />
            <svg className="absolute left-2 top-1.5 h-5 w-5 text-stone-500" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1110.65 3a7.5 7.5 0 016 13.65z" />
            </svg>
          </form>

          {!isAuth && (
            <>
              <Link to="/login" className="rounded-md px-3 py-2 text-sm font-medium text-stone-700 hover:bg-primary/10 dark:text-stone-200">
                Iniciar sesiÃ³n
              </Link>
              <Link to="/register" className="rounded-md bg-primary px-3 py-2 text-sm font-semibold text-white hover:opacity-95">
                Registrarse
              </Link>
            </>
          )}

          <Link to="/cart" className="relative rounded p-2 text-stone-600 hover:bg-primary/10 dark:text-stone-300" aria-label="Carrito">
            <svg fill="currentColor" width="20" height="20" viewBox="0 0 256 256">
              <path d="M222.14,58.87A8,8,0,0,0,216,56H54.68L49.7,27.44A8,8,0,0,0,42,24H16a8,8,0,0,0,0,16H34.29l30.36,139.86A28,28,0,1,0,116,204h76a28,28,0,1,0,27.14-39.13L199.09,88h11.78A8,8,0,0,0,222.14,58.87Z" />
            </svg>
            {count > 0 && (
              <span className="absolute -right-1 -top-1 min-w-[18px] rounded-full bg-primary px-1.5 text-center text-[10px] font-bold leading-4 text-white">
                {count}
              </span>
            )}
          </Link>

          {isAuth && (
            <>
              <Link
                to="/account"
                className="relative rounded-full p-2 text-stone-600 hover:bg-primary/10 dark:text-stone-300"
                aria-label="Perfil de usuario"
                title={user?.sub || "Mi cuenta"}
              >
                <svg fill="currentColor" width="20" height="20" viewBox="0 0 24 24">
                  <path d="M12 2a5 5 0 0 1 5 5v1a5 5 0 1 1-10 0V7a5 5 0 0 1 5-5zm0 10a4 4 0 0 0-4 4v3h8v-3a4 4 0 0 0-4-4z" />
                </svg>
              </Link>
              <button
                onClick={handleLogout}
                className="rounded-md px-3 py-2 text-sm font-medium text-stone-700 hover:bg-primary/10 dark:text-stone-200"
                aria-label="Salir"
              >
                Salir
              </button>
            </>
          )}
        </div>
      </div>
    </header>
  );
}

----- FILE: .\src\components\Pagination.jsx -----
import { Link } from "react-router-dom";

export default function Pagination({ page, totalPages, makeHref }) {
  const windowSize = 1; // muestra pÃ¡gina actual +-1 como en la ref
  const pages = [];
  for (let i = Math.max(1, page - windowSize); i <= Math.min(totalPages, page + windowSize); i++) {
    pages.push(i);
  }

  return (
    <nav className="flex items-center gap-3 text-sm">
      <Link
        to={makeHref(Math.max(1, page - 1))}
        className="px-3 py-1 rounded-md border border-stone-700 text-stone-300 hover:bg-stone-800"
      >
        &lt;
      </Link>

      {page - windowSize > 1 && <span className="text-stone-500">â€¦</span>}

      {pages.map((n) =>
        n === page ? (
          <span key={n} className="px-3 py-1 rounded-md bg-amber-600 text-white font-semibold">{n}</span>
        ) : (
          <Link
            key={n}
            to={makeHref(n)}
            className="px-3 py-1 rounded-md border border-stone-700 text-stone-300 hover:bg-stone-800"
          >
            {n}
          </Link>
        )
      )}

      {page + windowSize < totalPages && <span className="text-stone-500">â€¦</span>}

      <Link
        to={makeHref(Math.min(totalPages, page + 1))}
        className="px-3 py-1 rounded-md border border-stone-700 text-stone-300 hover:bg-stone-800"
      >
        &gt;
      </Link>
    </nav>
  );
}

----- FILE: .\src\components\ProductCard.jsx -----
import { Link } from "react-router-dom";

export default function ProductCard({ p }) {
  const price = Number(p?.price ?? 0);
  const fmt = n =>
    new Intl.NumberFormat("en-US", { style: "currency", currency: "USD", maximumFractionDigits: 0 }).format(n);

  return (
    <article className="w-full max-w-[340px]">
      <Link to={`/product/${p.id}`} className="block">
        <div className="rounded-xl bg-[#F8D0B3] overflow-hidden">
          <div className="aspect-[4/5] w-full">
            <img
              src={p.image || p.images?.[0]}
              alt={p.name}
              className="h-full w-full object-cover"
              loading="lazy"
            />
          </div>
          <div className="h-1.5 w-2/3 mx-auto -mt-2 mb-3 rounded-full bg-black/20" />
        </div>
      </Link>

      <div className="px-1 pt-2">
        <Link to={`/product/${p.id}`} className="text-[13px] leading-tight text-stone-200 hover:underline">
          {p.name}
        </Link>
        <div className="mt-1 text-[13px] font-semibold text-amber-500">{fmt(price)}</div>
        <Link
          to={`/product/${p.id}`}
          className="mt-2 inline-flex w-full items-center justify-center rounded-lg bg-amber-600 px-4 py-2 text-[12px] font-semibold text-white hover:bg-amber-500"
        >
          Ver producto
        </Link>
      </div>
    </article>
  );
}

----- FILE: .\src\components\RoleToggle.jsx -----
//ADMIN Y USUARIO

import { useRole } from "../auth/RoleContext";

export default function RoleToggle({ className = "" }) {
  const { role, setRole } = useRole();
  const next = role === "ADMIN" ? "USER" : "ADMIN";
  return (
    <button
      onClick={() => setRole(next)}
      className={`px-3 py-2 rounded border border-primary text-primary hover:bg-primary/10 ${className}`}
      title="Alternar vista"
    >
      Vista: {role}
    </button>
  );
}

----- FILE: .\src\context\AuthContext.jsx -----
// src/context/AuthContext.jsx
import { createContext, useContext, useEffect, useMemo, useState } from "react";

const AuthCtx = createContext(null);

function decodeJwt(token) {
  try {
    const payload = token.split(".")[1];
    const json = JSON.parse(atob(payload.replace(/-/g, "+").replace(/_/g, "/")));
    return json || {};
  } catch {
    return {};
  }
}

// normaliza authorities desde distintos layouts de payload
function pickAuthorities(user) {
  if (!user) return [];
  if (Array.isArray(user.authorities)) return user.authorities.map(String);
  if (Array.isArray(user.roles))       return user.roles.map(String);
  if (typeof user.scope === "string")  return user.scope.split(" ").map(String);
  if (typeof user.role  === "string")  return [user.role];
  return [];
}

export function AuthProvider({ children }) {
  const [token, setToken] = useState(() => localStorage.getItem("token") || null);
  const [user,  setUser]  = useState(() => (token ? decodeJwt(token) : null));

  const login = (accessToken) => {
    localStorage.setItem("token", accessToken);
    // nunca escribir localStorage.role
    setToken(accessToken);
    setUser(decodeJwt(accessToken));
  };

  const logout = () => {
    localStorage.removeItem("token");
    localStorage.removeItem("role"); // limpia flag simulado si existiera
    setToken(null);
    setUser(null);
  };

  useEffect(() => {
    if (token) setUser(decodeJwt(token));
  }, [token]);

  const authorities = useMemo(() => pickAuthorities(user), [user]);
  const isAdmin = useMemo(() => authorities.includes("ADMIN"), [authorities]);

  const value = useMemo(
    () => ({ token, user, login, logout, isAuth: !!token, authorities, isAdmin }),
    [token, user, authorities, isAdmin]
  );

  return <AuthCtx.Provider value={value}>{children}</AuthCtx.Provider>;
}

export const useAuth = () => useContext(AuthCtx);

----- FILE: .\src\context\ShopContext.jsx -----
// src/context/ShopContext.jsx
import { createContext, useContext, useEffect, useMemo, useReducer } from "react";
import { api } from "../lib/api";

// Util: precio final con descuento
const priceWithDiscount = (p) =>
  Math.round((Number(p?.price) || 0) * (1 - (Number(p?.discount) || 0) / 100));

const ShopCtx = createContext(null);

const initial = {
  products: [],
  filters: { q: "", cat: "all", min: 0, max: 99999 },
  cart: [],                // {id,name,price,discount,qty}
  status: "idle",
  error: null,
  // para animaciones (badge que rebota al agregar)
  lastAddedId: null,
  lastAddedAt: 0,
};

// normalizador seguro por si el backend envÃ­a distintos envoltorios
const toArray = (data) => {
  if (Array.isArray(data)) return data;
  if (Array.isArray(data?.data)) return data.data;
  if (Array.isArray(data?.content)) return data.content;
  if (Array.isArray(data?.items)) return data.items;
  return [];
};

function reducer(state, action) {
  switch (action.type) {
    case "SET_PRODUCTS":
      return { ...state, products: action.payload };

    case "SET_FILTERS":
      return { ...state, filters: { ...state.filters, ...action.payload } };

    case "ADD": {
      const p = action.payload;
      const i = state.cart.find((x) => x.id === p.id);
      const nextCart = i
        ? state.cart.map((x) =>
            x.id === p.id ? { ...x, qty: (x.qty || 1) + 1 } : x
          )
        : [
            ...state.cart,
            {
              id: p.id,
              name: p.name,
              price: p.price,
              discount: p.discount || 0,
              qty: 1,
            },
          ];
      return {
        ...state,
        cart: nextCart,
        lastAddedId: p.id,
        lastAddedAt: Date.now(),
      };
    }

    case "REMOVE":
      return { ...state, cart: state.cart.filter((i) => i.id !== action.payload) };

    case "SET_QTY":
      return {
        ...state,
        cart: state.cart.map((i) =>
          i.id === action.payload.id ? { ...i, qty: action.payload.qty || 1 } : i
        ),
      };

    case "CLEAR":
      return { ...state, cart: [] };

    case "STATUS":
      return {
        ...state,
        status: action.payload.status,
        error: action.payload.error || null,
      };

    default:
      return state;
  }
}

export function ShopProvider({ children }) {
  const [state, dispatch] = useReducer(reducer, initial);

  // Carga de productos
  useEffect(() => {
    let alive = true;
    (async () => {
      dispatch({ type: "STATUS", payload: { status: "loading" } });
      try {
        const raw = await api.listProducts();
        const list = toArray(raw);
        if (!alive) return;
        dispatch({ type: "SET_PRODUCTS", payload: list });
        dispatch({ type: "STATUS", payload: { status: "ready" } });
      } catch (e) {
        if (!alive) return;
        console.error("load products failed", e);
        dispatch({ type: "SET_PRODUCTS", payload: [] });
        dispatch({
          type: "STATUS",
          payload: { status: "error", error: String(e?.message || e) },
        });
      }
    })();
    return () => {
      alive = false;
    };
  }, []);

  // Siempre array
  const products = Array.isArray(state.products) ? state.products : [];

  // Filtros del catÃ¡logo
  const filtered = useMemo(() => {
    const { q, cat, min, max } = state.filters;
    const qlc = (q || "").toLowerCase();
    return products
      .filter((p) => (Number(p?.stock) || 0) > 0) // ocultar sin stock
      .filter(
        (p) =>
          cat === "all" ||
          String(p?.category || p?.cat || "")
            .toLowerCase()
            .includes(String(cat).toLowerCase())
      )
      .filter((p) => String(p?.name || "").toLowerCase().includes(qlc))
      .filter((p) => {
        const pr = priceWithDiscount(p);
        return pr >= Number(min || 0) && pr <= Number(max || 999999);
      });
  }, [products, state.filters]);

  // Total del carrito
  const total = useMemo(
    () =>
      state.cart.reduce(
        (t, i) =>
          t +
          Math.round(Number(i.price || 0) * (1 - (Number(i.discount) || 0) / 100)) *
            (Number(i.qty) || 1),
        0
      ),
    [state.cart]
  );

  // Helpers de alto nivel para componentes
  const addToCart = (product) => dispatch({ type: "ADD", payload: product });
  const removeFromCart = (id) => dispatch({ type: "REMOVE", payload: id });
  const setCartQty = (id, qty) => dispatch({ type: "SET_QTY", payload: { id, qty } });
  const clearCart = () => dispatch({ type: "CLEAR" });

  const value = {
    state,
    dispatch,
    filtered,
    total,
    priceWithDiscount,
    api, // expuesto para vistas admin y detalle
    // helpers
    addToCart,
    removeFromCart,
    setCartQty,
    clearCart,
  };

  return <ShopCtx.Provider value={value}>{children}</ShopCtx.Provider>;
}

export const useShop = () => useContext(ShopCtx);

----- FILE: .\src\pages\admin\EditProduct.jsx -----
// SOLO ADMINISTRADOR

import { useEffect, useMemo, useState } from "react";
import { useNavigate, useParams } from "react-router-dom";

const API = import.meta.env.VITE_API_URL ?? "http://localhost:4002";

export default function EditProduct() {
  const { id } = useParams(); // "new" o un id numÃ©rico
  const nav = useNavigate();
  const creating = useMemo(() => id === "new", [id]);

  const [loading, setLoading] = useState(!creating);
  const [saving, setSaving] = useState(false);
  const [images, setImages] = useState([]);
  const [specs, setSpecs] = useState([
    { k: "Top Wood", v: "" },
    { k: "Back & Sides Wood", v: "" },
    { k: "Neck Wood", v: "" },
  ]);

  const [form, setForm] = useState({
    name: "",
    description: "",
    price: "",
    activo: true,
    categoryId: "",
  });

  // Cargar producto existente
  useEffect(() => {
    if (creating) return;
    (async () => {
      setLoading(true);
      const r = await fetch(`${API}/products/${id}`);
      if (!r.ok) return nav("/admin/products");
      const p = await r.json();
      setForm({
        name: p.name ?? "",
        description: p.description ?? "",
        price: p.price ?? "",
        activo: p.activo ?? true,
        categoryId: p.category?.id ?? p.category_id ?? "",
      });
      setImages(p.images ?? []);
      setSpecs(
        (p.specifications ?? []).map(s => ({ k: s.name ?? s.key, v: s.value }))
      );
      setLoading(false);
    })();
  }, [creating, id, nav]);

  const onChange = e =>
    setForm(f => ({ ...f, [e.target.name]: e.target.type === "checkbox" ? e.target.checked : e.target.value }));

  const upsert = async () => {
    setSaving(true);
    const body = {
      name: form.name,
      description: form.description,
      price: parseFloat(form.price || 0),
      activo: !!form.activo,
      categoryId: form.categoryId || null,
      specifications: specs.filter(s => s.k && s.v).map(s => ({ name: s.k, value: s.v })),
    };
    const r = await fetch(`${API}/products${creating ? "" : `/${id}`}`, {
      method: creating ? "POST" : "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body),
    });
    if (r.ok) {
      const saved = await r.json();
      // Subir imÃ¡genes nuevas si hay File objects en images[]
      const files = images.filter(x => x instanceof File);
      if (files.length) {
        const fd = new FormData();
        files.forEach(f => fd.append("files", f));
        await fetch(`${API}/products/${creating ? saved.id : id}/images`, { method: "POST", body: fd });
      }
      nav(`/admin/products/${creating ? saved.id : id}`);
    }
    setSaving(false);
  };

  const del = async () => {
    if (creating) return;
    if (!confirm("Eliminar producto?")) return;
    const r = await fetch(`${API}/products/${id}`, { method: "DELETE" });
    if (r.ok) nav("/admin/products");
  };

  if (loading) return <div className="p-6">Cargandoâ€¦</div>;

  return (
    <div className="max-w-6xl mx-auto p-4 grid lg:grid-cols-2 gap-6">
      {/* GalerÃ­a */}
      <section>
        <div className="aspect-video rounded-lg overflow-hidden bg-stone-900/30 grid place-items-center">
          {images[0] && !(images[0] instanceof File) ? (
            <img src={images[0].url ?? images[0]} alt="" className="h-full w-full object-cover" />
          ) : images[0] ? (
            <img src={URL.createObjectURL(images[0])} className="h-full w-full object-cover" />
          ) : (
            <span className="text-stone-400">Sin imagen</span>
          )}
        </div>

        <div className="mt-3 grid grid-cols-3 gap-3">
          {images.slice(0, 3).map((img, i) => (
            <div key={i} className="aspect-video rounded overflow-hidden bg-stone-900/30">
              {img instanceof File ? (
                <img src={URL.createObjectURL(img)} className="h-full w-full object-cover" />
              ) : (
                <img src={img.url ?? img} className="h-full w-full object-cover" />
              )}
            </div>
          ))}
        </div>

        <label className="mt-4 block border-2 border-dashed rounded-lg py-4 text-center cursor-pointer">
          <input
            type="file"
            multiple
            accept="image/*"
            className="hidden"
            onChange={e => setImages(prev => [...prev, ...Array.from(e.target.files || [])])}
          />
          AÃ±adir imÃ¡genes
        </label>
      </section>

      {/* Formulario */}
      <section className="space-y-3">
        <input
          name="name"
          value={form.name}
          onChange={onChange}
          placeholder="Nombre del producto"
          className="w-full rounded border-stone-600 bg-transparent"
        />
        <textarea
          name="description"
          value={form.description}
          onChange={onChange}
          rows={5}
          placeholder="DescripciÃ³n"
          className="w-full rounded border-stone-600 bg-transparent"
        />
        <input
          name="price"
          type="number"
          step="0.01"
          value={form.price}
          onChange={onChange}
          placeholder="Precio"
          className="w-full rounded border-stone-600 bg-transparent"
        />
        <div className="flex items-center gap-3">
          <label className="inline-flex items-center gap-2">
            <input type="checkbox" name="activo" checked={form.activo} onChange={onChange} />
            Activo
          </label>
          <input
            name="categoryId"
            value={form.categoryId}
            onChange={onChange}
            placeholder="Category ID"
            className="rounded border-stone-600 bg-transparent"
          />
        </div>

        <div className="pt-4">
          <h3 className="font-semibold mb-2">Especificaciones</h3>
          <div className="space-y-2">
            {specs.map((s, i) => (
              <div key={i} className="grid grid-cols-2 gap-2">
                <input
                  value={s.k}
                  onChange={e => setSpecs(arr => arr.map((x, ix) => (ix === i ? { ...x, k: e.target.value } : x)))}
                  placeholder="Nombre"
                  className="rounded border-stone-600 bg-transparent"
                />
                <input
                  value={s.v}
                  onChange={e => setSpecs(arr => arr.map((x, ix) => (ix === i ? { ...x, v: e.target.value } : x)))}
                  placeholder="Valor"
                  className="rounded border-stone-600 bg-transparent"
                />
              </div>
            ))}
            <button
              type="button"
              onClick={() => setSpecs(s => [...s, { k: "", v: "" }])}
              className="text-primary hover:underline"
            >
              + AÃ±adir especificaciÃ³n
            </button>
          </div>
        </div>

        <div className="flex gap-3 pt-4">
          <button
            onClick={upsert}
            disabled={saving}
            className="px-4 py-2 rounded bg-primary text-white disabled:opacity-50"
          >
            {creating ? "Crear" : "Guardar"}
          </button>
          {!creating && (
            <button onClick={del} className="px-4 py-2 rounded border border-red-600 text-red-600">
              Eliminar
            </button>
          )}
        </div>
      </section>
    </div>
  );
}

----- FILE: .\src\pages\admin\ProductEditor.jsx -----
// src/pages/admin/ProductEditor.jsx
import { useEffect, useMemo, useState } from "react";
import { useParams, useNavigate } from "react-router-dom";
import { useRole } from "../../auth/RoleContext.jsx";
import { useShop } from "../../context/ShopContext.jsx";
import { useAuth } from "../../context/AuthContext.jsx";

const BASE = import.meta.env.VITE_API_URL ?? "http://localhost:4002/api";
const emptySpec = () => ({ name: "", value: "" });

export default function ProductEditor() {
  const { id } = useParams();
  const navigate = useNavigate();
  const { role } = useRole();
  const { api } = useShop();                // usa helpers con auth
  const { token } = useAuth();              // para uploads binarios

  // seguridad extra
  if (role !== "ADMIN") return null;

  const [loading, setLoading] = useState(true);
  const [images, setImages] = useState([]); // {url, file?}
  const [name, setName] = useState("");
  const [shortDesc, setShortDesc] = useState("");
  const [price, setPrice] = useState("");
  const [stock, setStock] = useState(0);
  const [longDesc, setLongDesc] = useState("");
  const [specs, setSpecs] = useState([emptySpec()]);

  // cargar producto
  useEffect(() => {
    let alive = true;
    (async () => {
      try {
        const p = await api.getProduct(id);            // GET /api/products/:id
        if (!alive) return;
        setName(p.name ?? "");
        setShortDesc(p.description ?? "");
        setPrice(String(p.price ?? ""));
        setStock(p.stock ?? 0);
        setLongDesc(p.longDescription ?? "");
        setSpecs((p.specs ?? []).map(s => ({ name: s.name, value: s.value })) || [emptySpec()]);
        // normaliza imÃ¡genes a {url}
        const imgs = Array.isArray(p.images) ? p.images : [];
        setImages(imgs.map(u => ({ url: u })));
      } catch (e) {
        console.error(e);
        alert("No se pudo cargar el producto");
        navigate("/admin");
      } finally {
        if (alive) setLoading(false);
      }
    })();
    return () => { alive = false; };
  }, [id, api, navigate]);

  const handleAddSpec = () => setSpecs(a => [...a, emptySpec()]);
  const handleSpecChange = (i, key, val) =>
    setSpecs(a => a.map((s, idx) => (idx === i ? { ...s, [key]: val } : s)));
  const handleRemoveSpec = (i) => setSpecs(a => a.filter((_, idx) => idx !== i));

  const handleAddImages = (files) => {
    const list = Array.from(files).slice(0, 6 - images.length);
    const mapped = list.map(f => ({ file: f, url: URL.createObjectURL(f) }));
    setImages(prev => [...prev, ...mapped]);
  };
  const handleRemoveImage = (i) =>
    setImages(prev => prev.filter((_, idx) => idx !== i));

  const payload = () => ({
    name,
    description: shortDesc,
    longDescription: longDesc,
    price: Number(price) || 0,
    stock: Number(stock) || 0,
    specs: specs.filter(s => s.name || s.value),
  });

  // guardar con AUTH
  const save = async () => {
    try {
      // 1) datos
      await api.patchProduct(id, payload());           // PATCH /api/products/:id con Bearer

      // 2) imÃ¡genes nuevas
      const form = new FormData();
      images.forEach(im => { if (im.file) form.append("files", im.file); });
      if ([...form.keys()].length) {
        const res = await fetch(`${BASE}/products/${id}/images`, {
          method: "POST",
          headers: { Authorization: `Bearer ${token}` }, // â† necesario
          body: form,
        });
        if (!res.ok) throw new Error("Error subiendo imÃ¡genes");
      }

      alert("Guardado");
      navigate("/admin");
    } catch (e) {
      console.error(e);
      alert(e.message || "Error al guardar");
    }
  };

  const del = async () => {
    if (!confirm("Â¿Eliminar producto?")) return;
    try {
      await api.deleteProduct(id);                     // DELETE /api/products/:id con Bearer
      navigate("/admin");
    } catch (e) {
      alert("No se pudo eliminar");
    }
  };

  if (loading) return <main className="p-8 text-stone-300">Cargandoâ€¦</main>;

  // UI
  return (
    <main className="mx-auto max-w-7xl px-6 py-10">
      <div className="mb-6 text-sm text-stone-400">
        <button onClick={() => navigate(-1)} className="hover:text-primary">Volver</button>
        <span className="mx-2">/</span>
        <span className="text-stone-200">Editar producto</span>
      </div>

      <div className="grid gap-8 lg:grid-cols-2">
        {/* ImÃ¡genes */}
        <section>
          <div className="relative aspect-[16/11] w-full overflow-hidden rounded-xl bg-stone-800">
            {images[0] ? (
              <img src={images[0].url} className="h-full w-full object-cover" />
            ) : (
              <div className="flex h-full items-center justify-center text-stone-500">Sin imagen</div>
            )}
            <input
              type="file"
              accept="image/*"
              className="absolute inset-0 cursor-pointer opacity-0"
              onChange={(e) => handleAddImages(e.target.files)}
            />
          </div>

          <div className="mt-4 grid grid-cols-2 gap-4">
            {[images[1], images[2]].map((im, i) => (
              <div key={i} className="relative aspect-[4/3] overflow-hidden rounded-xl bg-stone-800">
                {im ? (
                  <>
                    <img src={im.url} className="h-full w-full object-cover" />
                    <button
                      onClick={() => handleRemoveImage(i + 1)}
                      className="absolute right-2 top-2 rounded bg-black/60 px-2 py-1 text-xs text-white"
                    >
                      Quitar
                    </button>
                  </>
                ) : (
                  <div className="flex h-full items-center justify-center text-stone-500">â€”</div>
                )}
              </div>
            ))}
          </div>

          <label className="mt-6 flex h-28 cursor-pointer items-center justify-center rounded-xl border-2 border-dashed border-amber-600/50 text-amber-400 hover:bg-amber-600/5">
            Agregar imÃ¡genes
            <input multiple accept="image/*" type="file" className="hidden" onChange={(e) => handleAddImages(e.target.files)} />
          </label>
        </section>

        {/* Formulario */}
        <section>
          <input
            className="w-full rounded-lg border border-stone-700 bg-stone-900 px-4 py-3 text-3xl font-bold text-stone-100 focus:border-amber-600 focus:outline-none"
            value={name}
            onChange={(e) => setName(e.target.value)}
          />

          <textarea
            rows={3}
            className="mt-3 w-full rounded-lg border border-stone-700 bg-stone-900 px-4 py-3 text-sm text-stone-300 focus:border-amber-600 focus:outline-none"
            value={shortDesc}
            onChange={(e) => setShortDesc(e.target.value)}
            placeholder="Breve descripciÃ³nâ€¦"
          />

          <div className="mt-5 grid grid-cols-2 gap-4">
            <input
              className="w-full rounded-lg border border-stone-700 bg-stone-900 px-4 py-3 text-2xl font-bold text-amber-400 focus:border-amber-600 focus:outline-none"
              value={price}
              onChange={(e) => setPrice(e.target.value)}
              placeholder="$0.00"
            />
            <input
              type="number"
              min={0}
              className="w-full rounded-lg border border-stone-700 bg-stone-900 px-4 py-3 text-sm text-stone-300 focus:border-amber-600 focus:outline-none"
              value={stock}
              onChange={(e) => setStock(e.target.value)}
              placeholder="Stock"
            />
          </div>

          <div className="mt-5 flex gap-4">
            <button
              onClick={save}
              className="flex-1 rounded-lg bg-amber-600 px-6 py-3 text-sm font-semibold text-white hover:bg-amber-500"
            >
              Guardar
            </button>
            <button
              onClick={del}
              className="flex-1 rounded-lg bg-red-700/25 px-6 py-3 text-sm font-semibold text-red-300 hover:bg-red-700/35"
            >
              Eliminar
            </button>
          </div>

          <h3 className="mt-8 text-lg font-semibold text-stone-200">DescripciÃ³n</h3>
          <textarea
            rows={8}
            className="mt-3 w-full rounded-lg border border-stone-700 bg-stone-900 px-4 py-3 text-sm text-stone-300 focus:border-amber-600 focus:outline-none"
            value={longDesc}
            onChange={(e) => setLongDesc(e.target.value)}
          />

          <h3 className="mt-8 text-lg font-semibold text-stone-200">Especificaciones</h3>
          <div className="mt-4 space-y-3">
            {specs.map((s, i) => (
              <div key={i} className="grid grid-cols-2 gap-4">
                <input
                  className="rounded-lg border border-stone-700 bg-stone-900 px-3 py-2 text-sm text-stone-200 focus:border-amber-600 focus:outline-none"
                  value={s.name}
                  onChange={(e) => handleSpecChange(i, "name", e.target.value)}
                  placeholder="Top Wood"
                />
                <div className="flex gap-2">
                  <input
                    className="flex-1 rounded-lg border border-stone-700 bg-stone-900 px-3 py-2 text-sm text-stone-200 focus:border-amber-600 focus:outline-none"
                    value={s.value}
                    onChange={(e) => handleSpecChange(i, "value", e.target.value)}
                    placeholder="Solid Spruce"
                  />
                  <button
                    onClick={() => handleRemoveSpec(i)}
                    className="rounded-lg bg-stone-700 px-3 py-2 text-xs text-white hover:bg-stone-600"
                  >
                    X
                  </button>
                </div>
              </div>
            ))}
          </div>

          <button
            onClick={handleAddSpec}
            className="mt-4 w-full rounded-lg border-2 border-dashed border-amber-600/50 py-2 text-sm font-semibold text-amber-400 hover:bg-amber-600/5"
          >
            Agregar especificaciÃ³n
          </button>
        </section>
      </div>
    </main>
  );
}

----- FILE: .\src\pages\About.jsx -----
export default function About() {
  return (
    <main className="bg-background-light dark:bg-background-dark text-stone-800 dark:text-stone-200">
      <div className="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-16">
        <header className="text-center">
          <h1 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight">
            Sobre Nosotros
          </h1>
          <p className="mt-4 text-lg text-stone-600 dark:text-stone-400">
            La historia detrÃ¡s de cada acorde.
          </p>
        </header>

        <section className="mt-16 space-y-12">
          <div>
            <h2 className="text-3xl font-bold text-primary text-center">Nuestra Historia</h2>
            <p className="mt-4 text-lg leading-relaxed text-stone-600 dark:text-stone-400 text-center">
              String & Soul naciÃ³ de una pasiÃ³n compartida por la mÃºsica y la artesanÃ­a de las guitarras.
              Lo que comenzÃ³ como un pequeÃ±o taller se convirtiÃ³ en un punto de encuentro para la comunidad,
              con instrumentos de calidad y un trato cercano.
            </p>
          </div>

          <div className="grid gap-12 border-t border-primary/20 dark:border-primary/30 pt-12 md:grid-cols-2">
            <div>
              <h3 className="text-3xl font-bold text-primary">MisiÃ³n y VisiÃ³n</h3>
              <p className="mt-4 text-lg leading-relaxed text-stone-600 dark:text-stone-400">
                <strong>MisiÃ³n:</strong> Inspirar y equipar a mÃºsicos de todos los niveles con
                instrumentos y servicio excepcionales.
              </p>
              <p className="mt-2 text-lg leading-relaxed text-stone-600 dark:text-stone-400">
                <strong>VisiÃ³n:</strong> Ser el destino de referencia para los amantes de la guitarra,
                preservando el legado y fomentando nuevas generaciones.
              </p>
            </div>

            <div>
              <h3 className="text-3xl font-bold text-primary">Nuestros Valores</h3>
              <ul className="mt-4 list-disc list-inside space-y-2 text-lg text-stone-600 dark:text-stone-400">
                <li><strong>Autenticidad:</strong> Cada guitarra tiene una historia.</li>
                <li><strong>Comunidad:</strong> Un lugar para conectar mediante la mÃºsica.</li>
                <li><strong>Calidad:</strong> EstÃ¡ndares altos de sonido y artesanÃ­a.</li>
                <li><strong>PasiÃ³n:</strong> Vivimos la mÃºsica en todo lo que hacemos.</li>
              </ul>
            </div>
          </div>
        </section>
      </div>
    </main>
  );
}

----- FILE: .\src\pages\Account.jsx -----
import { Link, useNavigate } from "react-router-dom";
import { useEffect, useMemo, useState } from "react";
import { useAuth } from "../context/AuthContext.jsx";
import { api } from "../lib/api.js";

const fmt = (n) =>
  new Intl.NumberFormat("es-AR", { style: "currency", currency: "USD", maximumFractionDigits: 0 })
    .format(Number(n || 0));

export default function Account() {
  const { user, logout } = useAuth();
  const nav = useNavigate();

  // nombre y email reales desde el JWT
  const email = user?.sub || user?.email || "usuario@desconocido";
  const name = useMemo(() => {
    const fn = user?.firstName || user?.given_name;
    const ln = user?.lastName || user?.family_name;
    if (fn || ln) return [fn, ln].filter(Boolean).join(" ");
    return String(email).split("@")[0] || "Usuario";
  }, [user, email]);
  const initials = useMemo(() => {
    const parts = String(name).trim().split(/\s+/).slice(0, 2);
    if (parts.length === 1) return parts[0].slice(0, 2).toUpperCase();
    return (parts[0][0] + parts[1][0]).toUpperCase();
  }, [name]);

  // cargar â€œmis comprasâ€
  const [orders, setOrders] = useState([]);
  const [loading, setLoading] = useState(true);
  const [err, setErr] = useState("");

  useEffect(() => {
    let alive = true;
    (async () => {
      try {
        const list = await api.myOrders(); // GET /api/compras/mias
        if (!alive) return;
        setOrders(Array.isArray(list) ? list : []);
      } catch (e) {
        if (!alive) return;
        setErr(e?.message || "Error cargando tus compras");
      } finally {
        if (alive) setLoading(false);
      }
    })();
    return () => { alive = false; };
  }, []);

  const onLogout = () => { logout(); nav("/"); };

  return (
    <div className="flex min-h-[70vh] items-start justify-center px-4 py-12 sm:py-20">
      <div className="w-full max-w-6xl">
        <div className="grid gap-6 md:grid-cols-3">
          {/* Perfil */}
          <div className="rounded-xl bg-[#14100b] p-6">
            <div className="flex flex-col items-center gap-4 text-center">
              <div className="flex h-28 w-28 items-center justify-center rounded-full bg-stone-100 text-2xl font-semibold text-stone-700 dark:bg-stone-700 dark:text-white">
                {initials}
              </div>
              <div>
                <h3 className="text-lg font-semibold text-stone-900 dark:text-white">{name}</h3>
                <p className="text-sm text-stone-600 dark:text-stone-300">{email}</p>
              </div>

              <div className="mt-4 flex w-full flex-col gap-2">
                <Link
                  to="/account/edit"
                  className="w-full rounded-md border border-stone-200 px-3 py-2 text-center text-sm dark:border-stone-700"
                >
                  Editar perfil
                </Link>
                <button onClick={onLogout} className="w-full rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white">
                  Cerrar sesiÃ³n
                </button>
              </div>
            </div>
          </div>

          {/* Mis compras */}
          <div className="md:col-span-2 rounded-xl bg-[#14100b] p-6">
            <h3 className="mb-4 text-lg font-semibold text-stone-900 dark:text-white">Mis compras</h3>

            {loading && <div className="text-stone-300">Cargandoâ€¦</div>}
            {err && !loading && <div className="text-red-400">{err}</div>}

            {!loading && !err && (
              orders.length ? (
                <ul className="space-y-3">
                  {orders.map(o => (
                    <li key={o.id} className="rounded-md border border-stone-700 p-4">
                      <div className="flex items-center justify-between">
                        <div className="text-sm text-stone-300">Orden #{o.id}</div>
                        <div className="text-sm font-semibold">{fmt(o.total)}</div>
                      </div>
                      <div className="mt-2 text-xs text-stone-400">
                        {o.date ?? ""}
                      </div>

                      {/* Ãtems */}
                      <div className="mt-3 divide-y divide-white/10 rounded-md border border-white/10">
                        {(o.items || []).map((it, idx) => (
                          <div key={idx} className="grid grid-cols-[1fr,auto,auto] gap-3 px-3 py-2 text-sm">
                            <div className="truncate">{it.productName}</div>
                            <div className="text-right">x{it.quantity}</div>
                            <div className="text-right">{fmt(it.lineTotal ?? (it.priceUnit * it.quantity))}</div>
                          </div>
                        ))}
                      </div>
                    </li>
                  ))}
                </ul>
              ) : (
                <div className="rounded-md border border-stone-700 p-6 text-stone-300">
                  No tenÃ©s compras aÃºn.
                </div>
              )
            )}
          </div>
        </div>
      </div>
    </div>
  );
}

----- FILE: .\src\pages\AdminProductEdit.jsx -----
import { useEffect, useMemo, useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import { useRole } from "../auth/RoleContext.jsx";

export default function AdminProducts() {
  const { role } = useRole();
  const navigate = useNavigate();

  const [rows, setRows] = useState([]);
  const [q, setQ] = useState("");
  const [loading, setLoading] = useState(true);

  // seguridad extra (la ruta ya estÃ¡ protegida)
  if (role !== "ADMIN") return null;

  useEffect(() => {
    let alive = true;
    (async () => {
      try {
        const r = await fetch("http://localhost:4002/products");
        const data = await r.json();
        if (!alive) return;
        setRows(Array.isArray(data) ? data : data.content ?? []);
      } catch {
        setRows([]);
      } finally {
        if (alive) setLoading(false);
      }
    })();
    return () => (alive = false);
  }, []);

  const filtered = useMemo(() => {
    const term = q.trim().toLowerCase();
    if (!term) return rows;
    return rows.filter((p) =>
      [p.name, p.description, String(p.id)]
        .filter(Boolean)
        .some((v) => String(v).toLowerCase().includes(term))
    );
  }, [rows, q]);

  const del = async (id) => {
    if (!confirm("Â¿Eliminar producto?")) return;
    const r = await fetch(`http://localhost:4002/products/${id}`, {
      method: "DELETE",
    });
    if (!r.ok) return alert("No se pudo eliminar");
    setRows((s) => s.filter((p) => p.id !== id));
  };

  const createNew = async () => {
    const body = {
      name: "Nuevo producto",
      description: "",
      longDescription: "",
      price: 0,
      stock: 0,
      specs: [],
      activo: true,
    };
    const r = await fetch("http://localhost:4002/products", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body),
    });
    if (!r.ok) return alert("No se pudo crear");
    const created = await r.json();
    navigate(`/admin/products/${created.id}/edit`);
  };

  return (
    <main className="mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8">
      <header className="mb-6 flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center">
        <h1 className="text-2xl font-bold text-white">Administrar productos</h1>

        <div className="flex w-full max-w-xl items-center gap-3 sm:w-auto">
          <input
            value={q}
            onChange={(e) => setQ(e.target.value)}
            placeholder="Buscar por nombre, descripciÃ³n o IDâ€¦"
            className="w-full rounded-md border border-stone-700 bg-stone-900 px-3 py-2 text-sm text-stone-200 placeholder-stone-400 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
          />
          <button
            onClick={createNew}
            className="rounded-md bg-primary px-4 py-2 text-sm font-semibold text-white hover:bg-primary/90"
          >
            Nuevo
          </button>
        </div>
      </header>

      {loading ? (
        <div className="text-stone-300">Cargandoâ€¦</div>
      ) : (
        <div className="overflow-x-auto rounded-lg border border-stone-800">
          <table className="min-w-full divide-y divide-stone-800">
            <thead className="bg-stone-900/60">
              <tr>
                <Th>ID</Th>
                <Th>Nombre</Th>
                <Th className="text-right">Precio</Th>
                <Th className="text-right">Stock</Th>
                <Th>Activo</Th>
                <Th className="text-right">Acciones</Th>
              </tr>
            </thead>
            <tbody className="divide-y divide-stone-800 bg-stone-900/30">
              {filtered.map((p) => (
                <tr key={p.id} className="hover:bg-stone-900/60">
                  <Td>{p.id}</Td>
                  <Td>
                    <div className="flex items-center gap-3">
                      {p.images?.[0] && (
                        <img
                          src={p.images[0]}
                          alt=""
                          className="h-10 w-10 rounded object-cover"
                        />
                      )}
                      <div className="max-w-[32ch] truncate">{p.name}</div>
                    </div>
                  </Td>
                  <Td className="text-right">${Number(p.price ?? 0).toLocaleString()}</Td>
                  <Td className="text-right">{p.stock ?? 0}</Td>
                  <Td>
                    <span
                      className={`rounded px-2 py-0.5 text-xs ${
                        p.activo ? "bg-green-500/15 text-green-400" : "bg-stone-700 text-stone-300"
                      }`}
                    >
                      {p.activo ? "SÃ­" : "No"}
                    </span>
                  </Td>
                  <Td className="text-right">
                    <div className="flex justify-end gap-2">
                      <Link
                        to={`/admin/products/${p.id}/edit`}
                        className="rounded-md bg-stone-700 px-3 py-1.5 text-xs font-semibold text-stone-100 hover:bg-stone-600"
                      >
                        Editar
                      </Link>
                      <button
                        onClick={() => del(p.id)}
                        className="rounded-md bg-red-600/20 px-3 py-1.5 text-xs font-semibold text-red-400 hover:bg-red-600/30"
                      >
                        Eliminar
                      </button>
                    </div>
                  </Td>
                </tr>
              ))}

              {filtered.length === 0 && (
                <tr>
                  <Td colSpan={6} className="py-10 text-center text-stone-400">
                    No hay resultados.
                  </Td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      )}
    </main>
  );
}

/* helpers visuales */
function Th({ children, className = "" }) {
  return (
    <th
      className={
        "px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-stone-300 " +
        className
      }
    >
      {children}
    </th>
  );
}
function Td({ children, className = "", colSpan }) {
  return (
    <td className={"px-4 py-3 text-sm text-stone-200 " + className} colSpan={colSpan}>
      {children}
    </td>
  );
}

----- FILE: .\src\pages\AdminProducts.jsx -----
// src/pages/AdminProducts.jsx
import {useEffect, useState} from 'react'
import {useShop} from '../context/ShopContext'
import {v4 as uuid} from 'uuid'
export default function AdminProducts(){
  const {state:{products}, api} = useShop()
  const [list,setList]=useState([])
  const [form,setForm]=useState({name:'',price:0,stock:0,category:'elÃ©ctrica',images:[''],description:'',discount:0})
  const load=()=> api.list().then(setList)
  useEffect(load,[])
  const submit=async(e)=>{ e.preventDefault()
    const data=form.id? form : {...form, id: uuid()}
    await (form.id? api.update(data): api.create(data))
    setForm({name:'',price:0,stock:0,category:'elÃ©ctrica',images:[''],description:'',discount:0})
    load()
  }
  const edit=(p)=> setForm({...p})
  const del=async(id)=>{ await api.remove(id); load() }

  return (
    <section style={{padding:16,display:'grid',gridTemplateColumns:'1fr 1fr',gap:16}}>
      <form onSubmit={submit}>
        <h3>{form.id?'Editar':'Nuevo'} producto</h3>
        <input placeholder="Nombre" value={form.name} onChange={e=>setForm({...form,name:e.target.value})}/>
        <input type="number" placeholder="Precio" value={form.price} onChange={e=>setForm({...form,price:+e.target.value})}/>
        <input type="number" placeholder="Stock" value={form.stock} onChange={e=>setForm({...form,stock:+e.target.value})}/>
        <input placeholder="CategorÃ­a" value={form.category} onChange={e=>setForm({...form,category:e.target.value})}/>
        <input placeholder="URL imagen" value={form.images[0]||''} onChange={e=>setForm({...form,images:[e.target.value]})}/>
        <input type="number" placeholder="Descuento %" value={form.discount} onChange={e=>setForm({...form,discount:+e.target.value})}/>
        <textarea placeholder="DescripciÃ³n" value={form.description} onChange={e=>setForm({...form,description:e.target.value})}/>
        <button type="submit">Guardar</button>
      </form>

      <div>
        <h3>Publicaciones</h3>
        {(list.length?list:products).map(p=>(
          <div key={p.id} style={{display:'grid',gridTemplateColumns:'80px 1fr 120px 80px 80px',gap:8,alignItems:'center',marginBottom:8}}>
            <img src={p.images?.[0]} alt="" style={{width:80,height:60,objectFit:'cover'}}/>
            <div>{p.name}</div>
            <div>${p.price} â€¢ Stock {p.stock}</div>
            <button onClick={()=>edit(p)}>Editar</button>
            <button onClick={()=>del(p.id)}>Eliminar</button>
          </div>
        ))}
      </div>
    </section>
  )
}

----- FILE: .\src\pages\CartPage.jsx -----
import { Link, useNavigate } from "react-router-dom";
import { useShop } from "../context/ShopContext.jsx";
import { useAuth } from "../context/AuthContext.jsx";

const fmt = (n) =>
  new Intl.NumberFormat("es-AR", {
    style: "currency",
    currency: "USD",
    minimumFractionDigits: 0,
  }).format(Number(n || 0));

export default function CartPage() {
  const { state, dispatch, priceWithDiscount } = useShop();
  const { isAuth } = useAuth();
  const nav = useNavigate();

  const items = state.cart ?? [];
  const subtotal = items.reduce((t, i) => t + priceWithDiscount(i) * (i.qty || 1), 0);
  const setQty = (id, qty) =>
    dispatch({ type: "SET_QTY", payload: { id, qty: Math.max(1, qty | 0) } });

  // imagen confiable por item
  const getItemImage = (item) => {
    const prod = state.products?.find((p) => String(p.id) === String(item.id)) || null;
    return (
      item.image ||
      item.images?.[0] ||
      prod?.image ||
      prod?.images?.[0] ||
      ""
    );
  };

  const handleCheckout = () => {
    if (!items.length) return;
    if (!isAuth) {
      nav("/login?next=/checkout");
      return;
    }
    nav("/checkout");
  };

  return (
    <main className="bg-background-light text-white dark:bg-background-dark">
      <div className="mx-auto max-w-7xl px-6 py-10 lg:px-8">
        {/* Migas */}
        <p className="text-sm text-stone-400">
          <Link to="/catalog" className="hover:text-primary">Tienda</Link>
          <span className="mx-2">/</span>
          Carrito
        </p>

        <h1 className="mt-2 text-4xl font-extrabold">Carrito de compras</h1>

        {/* Layout principal */}
        <div className="mt-10 grid gap-8 lg:[grid-template-columns:minmax(0,1fr)_360px]">
          {/* LISTA */}
          <aside className="lg:col-start-1 lg:row-start-1 lg:sticky lg:top-24 h-max bg-transparent border-none rounded-none p-0">
            <section className="lg:col-span-8">
              {items.length ? (
                <ul className="divide-y divide-white/10">
                  {items.map((i) => {
                    const img = getItemImage(i);
                    return (
                      <li key={i.id} className="py-6 first:border-t first:border-white/10">
                        <div className="grid grid-cols-[96px,1fr,auto] items-center gap-6">
                          <Link
                            to={`/product/${i.id}`}
                            className="h-24 w-24 overflow-hidden rounded-lg bg-stone-800"
                          >
                            <img
                              src={img}
                              alt={i.name}
                              loading="lazy"
                              className="h-full w-full object-cover"
                            />
                          </Link>

                          <div className="flex flex-col gap-2">
                            <Link
                              to={`/product/${i.id}`}
                              className="text-lg font-semibold hover:text-primary"
                            >
                              {i.name}
                            </Link>
                            <p className="text-sm text-stone-400">{i.category}</p>

                            <div className="mt-1 flex items-center gap-3">
                              <button
                                onClick={() => setQty(i.id, (i.qty || 1) - 1)}
                                className="flex items-center justify-center h-8 w-8 rounded-full ring-1 ring-primary/30 hover:bg-primary/20"
                                aria-label="disminuir"
                              >
                                âˆ’
                              </button>
                              <input
                                value={i.qty || 1}
                                onChange={(e) => setQty(i.id, Number(e.target.value))}
                                className="w-12 rounded-md border border-primary/20 bg-transparent p-1 text-center"
                              />
                              <button
                                onClick={() => setQty(i.id, (i.qty || 1) + 1)}
                                className="flex items-center justify-center h-8 w-8 rounded-full ring-1 ring-primary/30 hover:bg-primary/20"
                                aria-label="aumentar"
                              >
                                +
                              </button>

                              <button
                                onClick={() => dispatch({ type: "REMOVE", payload: i.id })}
                                className="ml-3 text-sm text-stone-400 hover:text-primary"
                              >
                                Quitar
                              </button>
                            </div>
                          </div>

                          <p className="text-right text-lg font-semibold">
                            {fmt(priceWithDiscount(i) * (i.qty || 1))}
                          </p>
                        </div>
                      </li>
                    );
                  })}
                </ul>
              ) : (
                <div className="rounded-xl border border-white/10 p-8 text-center text-stone-300">
                  Carrito vacÃ­o.{" "}
                  <Link className="text-primary" to="/catalog">
                    Ir a la tienda
                  </Link>
                </div>
              )}
            </section>
          </aside>

          {/* RESUMEN */}
          <aside className="lg:col-start-2 lg:row-start-1 lg:sticky lg:top-24 h-max rounded-xl border border-primary/20 bg-primary/5 p-6">
            <h2 className="mb-4 text-lg font-bold">Resumen del pedido</h2>

            <div className="space-y-3 text-sm">
              <div className="flex justify-between">
                <span className="text-stone-300">Subtotal</span>
                <span className="font-medium">{fmt(subtotal)}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-stone-300">EnvÃ­o</span>
                <span className="font-medium">Gratis</span>
              </div>
              <div className="flex justify-between">
                <span className="text-stone-300">Impuestos</span>
                <span className="font-medium">{fmt(0)}</span>
              </div>
            </div>

            <div className="my-6 h-px bg-primary/20" />

            <div className="flex justify-between text-lg font-bold">
              <span>Total</span>
              <span>{fmt(subtotal)}</span>
            </div>

            <button
              disabled={!items.length}
              onClick={handleCheckout}
              className="mt-6 w-full rounded-lg bg-primary py-3 text-sm font-bold text-white shadow-lg shadow-primary/20 transition hover:brightness-105 disabled:opacity-50"
            >
              Continuar al pago
            </button>
          </aside>
        </div>
      </div>
    </main>
  );
}

----- FILE: .\src\pages\Catalog.jsx -----
import { useMemo } from "react";
import { useLocation } from "react-router-dom";
import Filters from "../components/Filters.jsx";
import ProductCard from "../components/ProductCard.jsx";
import { useShop } from "../context/ShopContext.jsx";

const norm = (s = "") => s.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu, "");
const CAT = { acoustic: "acÃºstica", electric: "elÃ©ctrica", bass: "bajo", classical: "clÃ¡sica" };

export default function Catalog() {
  const { state } = useShop();
  const { search } = useLocation();
  const sp = useMemo(() => new URLSearchParams(search), [search]);

  const catSlug = sp.get("cat") || "all";
  const wanted = catSlug !== "all" ? norm(CAT[catSlug] || catSlug) : "";

  const title =
    catSlug === "acoustic" ? "Guitarras AcÃºsticas" :
    catSlug === "electric" ? "Guitarras ElÃ©ctricas" :
    catSlug === "bass" ? "Bajos" :
    catSlug === "classical" ? "Guitarras ClÃ¡sicas" : "CatÃ¡logo";

  const products = useMemo(() => {
    const list = state?.products ?? [];
    if (!wanted) return list;
    return list.filter((p) => norm(p.category || "").includes(wanted));
  }, [state?.products, wanted]);

  return (
    <main className="mx-auto max-w-8x1 px-6 py-10">
      <div className="grid gap-8 grid-cols-[280px,1fr]">
        <Filters />
        <section>
          <h1 className="text-4xl font-bold text-stone-100 mb-8">{title}</h1>

          {/* Ajuste de la grilla */}
          <div className="grid gap-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5">
            {products.map((p) => (
  <ProductCard key={p.id} p={p} />
))}
{products.length === 0 && (
  <div className="text-stone-400 mt-6">Sin productos disponibles.</div>
)}
          </div>
        </section>
      </div>
    </main>
  );
}

----- FILE: .\src\pages\Checkout.jsx -----
import { useNavigate } from "react-router-dom";
import { useShop } from "../context/ShopContext.jsx";
import { useState } from "react";

export default function Checkout() {
  const { state, dispatch } = useShop();
  const nav = useNavigate();
  const [form, setForm] = useState({ email: "", store: "", name: "", last: "" });

  const onSubmit = (e) => {
    e.preventDefault();
    if (!state.cart.length) return;
    // Guardar datos del formulario
  sessionStorage.setItem("checkout.email", form.email);
  sessionStorage.setItem("checkout.store", form.store);
  sessionStorage.setItem("checkout.name", form.name);
  sessionStorage.setItem("checkout.last", form.last);
    
  nav("/payment");
  };

  return (
  <div className="flex min-h-[80vh] items-center justify-center">
    <main className="w-full max-w-3xl p-4 sm:p-6 lg:p-8">
      <h1 className="text-3xl font-bold">InformaciÃ³n</h1>

      <form onSubmit={onSubmit} className="mt-8 space-y-8">
        <section>
          <h2 className="text-xl font-semibold">Contacto</h2>
          <input
            type="email"
            required
            placeholder="Email"
            value={form.email}
            onChange={e => setForm({ ...form, email: e.target.value })}
            className="mt-3 w-full rounded-lg border bg-transparent px-4 py-3"
          />
          <label className="mt-3 flex items-center gap-2 text-sm opacity-80">
            <input type="checkbox" className="h-4 w-4 rounded" />
            Mantenerme al dÃ­a sobre ofertas.
          </label>
        </section>

        <section>
          <h2 className="text-xl font-semibold">Retiro en Sucursal</h2>
          <select
            required
            value={form.store}
            onChange={e => setForm({ ...form, store: e.target.value })}
            className="mt-3 w-full rounded-lg border bg-transparent px-4 py-3"
          >
            <option value="" disabled>Seleccione una sucursal</option>
            <option value="Centro">Centro</option>
            <option value="Norte">Norte</option>
            <option value="Sur">Sur</option>
          </select>

          <div className="mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2">
            <input
              required
              placeholder="Nombre"
              value={form.name}
              onChange={e => setForm({ ...form, name: e.target.value })}
              className="rounded-lg border bg-transparent px-4 py-3"
            />
            <input
              required
              placeholder="Apellido"
              value={form.last}
              onChange={e => setForm({ ...form, last: e.target.value })}
              className="rounded-lg border bg-transparent px-4 py-3"
            />
          </div>
        </section>

        <button
          type="submit"
          disabled={!state.cart.length}
          className="w-full rounded-lg bg-primary px-6 py-3 font-semibold text-white hover:bg-primary/80 disabled:opacity-50"
        >
          Continuar al pago
        </button>
      </form>
    </main>
  </div>
);
}

----- FILE: .\src\pages\CheckoutFinal.jsx -----
import { useMemo, useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import { useShop } from "../context/ShopContext.jsx";
import { useAuth } from "../context/AuthContext.jsx";
import { api } from "../lib/api.js";

const fmt = (n) =>
  new Intl.NumberFormat("es-AR", {
    style: "currency",
    currency: "USD",
    minimumFractionDigits: 0,
  }).format(Number(n || 0));

export default function CheckoutFinal() {
  const { state, dispatch, priceWithDiscount } = useShop();
  const { isAuth } = useAuth();
  const nav = useNavigate();

  const [submitting, setSubmitting] = useState(false);
  const [err, setErr] = useState("");

  const items = state.cart ?? [];
  const subtotal = useMemo(
    () => items.reduce((t, it) => t + priceWithDiscount(it) * (it.qty || 1), 0),
    [items, priceWithDiscount]
  );

  // datos persistidos
  const rawMethod = localStorage.getItem("payment.method") || "";
  const last4 = localStorage.getItem("payment.last4") || "";
  const store = sessionStorage.getItem("checkout.store") || "A confirmar en sucursal";
  const email = sessionStorage.getItem("checkout.email") || "â€”";

  // normaliza mÃ©todos posibles
  const methodMap = {
    credit: "credit",
    debit: "debit",
    cash: "cash",
    credito: "credit",
    debito: "debit",
    efectivo: "cash",
  };
  const method = methodMap[rawMethod] || "cash";

  // etiqueta final
  const methodLabel =
    method === "cash"
      ? "Efectivo al entregar"
      : `Tarjeta ${method === "debit" ? "de dÃ©bito" : "de crÃ©dito"}${
          last4 ? ` terminada en ${last4}` : ""
        }`;

  const onConfirm = async () => {
    setErr("");

    if (!isAuth) {
      nav("/login?next=/checkout/final");
      return;
    }

    const payload = {
      items: items.map((it) => ({
        productId: it.id,
        quantity: it.qty || 1,
      })),
    };

    if (!payload.items.length) {
      setErr("El carrito estÃ¡ vacÃ­o.");
      return;
    }

    try {
      setSubmitting(true);
      // Crea la compra en el backend (requiere token)
      await api.createOrder(payload);

      // Limpia estado y persistencias SOLO si la compra fue creada
      dispatch({ type: "CLEAR" });
      localStorage.removeItem("payment.method");
      localStorage.removeItem("payment.last4");
      sessionStorage.removeItem("checkout.store");
      sessionStorage.removeItem("checkout.email");
      sessionStorage.removeItem("checkout.name");
      sessionStorage.removeItem("checkout.last");

      // Feedback y redirecciÃ³n
      // Nota: asumimos que Swal estÃ¡ disponible como global si ya lo usabas.
      if (typeof Swal !== "undefined") {
        await Swal.fire({
          title: "Â¡Compra realizada!",
          text: "Tu pedido fue confirmado con Ã©xito.",
          icon: "success",
          confirmButtonText: "Aceptar",
          confirmButtonColor: "#b86614",
          background: "#2c1f13ff",
          color: "#f8f7f6",
          backdrop: "rgba(0,0,0,0.6)",
        });
      }
      nav("/account");
    } catch (e) {
      setErr(e?.message || "No se pudo confirmar la compra.");
    } finally {
      setSubmitting(false);
    }
  };

  return (
    <main className="bg-background-light text-white dark:bg-background-dark">
      <div className="mx-auto max-w-7xl px-6 py-10 lg:px-8">
        <h1 className="text-4xl font-extrabold">Checkout</h1>

        <div className="mt-10 grid gap-12 lg:grid-cols-2">
          {/* Columna izquierda: resumen de productos */}
          <section>
            <h2 className="mb-4 border-b border-primary/20 pb-2 text-xl font-semibold dark:border-primary/30">
              Resumen del pedido
            </h2>

            <ul className="divide-y divide-primary/20 dark:divide-primary/30">
              {items.map((it) => {
                const img = it.image || it.images?.[0];
                const totalItem = priceWithDiscount(it) * (it.qty || 1);
                return (
                  <li key={it.id} className="py-4">
                    <div className="grid grid-cols-[80px,1fr,auto] items-center gap-4">
                      <Link
                        to={`/product/${it.id}`}
                        className="h-20 w-20 overflow-hidden rounded-lg bg-stone-800"
                      >
                        {img ? (
                          <img
                            src={img}
                            alt={it.name}
                            className="h-full w-full object-cover"
                          />
                        ) : null}
                      </Link>

                      <div>
                        <Link
                          to={`/product/${it.id}`}
                          className="font-semibold hover:text-primary"
                        >
                          {it.name}
                        </Link>
                        <p className="text-sm text-stone-400">
                          {it.category} Â· Cant: {it.qty || 1}
                        </p>
                      </div>

                      <div className="text-right font-semibold">
                        {fmt(totalItem)}
                      </div>
                    </div>
                  </li>
                );
              })}
            </ul>

            <div className="mt-4 space-y-2 border-t border-primary/20 pt-4 dark:border-primary/30">
              <div className="flex justify-between text-base">
                <span>Subtotal</span>
                <span>{fmt(subtotal)}</span>
              </div>
              <div className="flex justify-between text-base">
                <span>EnvÃ­o</span>
                <span>Gratis</span>
              </div>
              <div className="flex justify-between border-t border-primary/20 pt-2 text-lg font-bold dark:border-primary/30">
                <span>Total</span>
                <span>{fmt(subtotal)}</span>
              </div>
              {method === "cash" && (
                <p className="text-sm text-amber-300/90">
                  RecordÃ¡ tener billetes en buen estado y, en lo posible, el
                  monto justo.
                </p>
              )}
            </div>
          </section>

          {/* Columna derecha: datos de retiro + mÃ©todo de pago */}
          <aside>
            <section className="space-y-6">
              <div>
                <h3 className="mb-3 border-b border-primary/20 pb-2 text-xl font-semibold dark:border-primary/30">
                  Retiro en sucursal
                </h3>
                <div className="rounded-lg border border-primary/20 p-4 dark:border-primary/30">
                  <p className="text-sm text-stone-300">Sucursal</p>
                  <p className="font-medium">{store}</p>
                  <p className="mt-2 text-sm text-stone-300">Contacto</p>
                  <p className="font-medium">{email}</p>
                </div>
              </div>

              <div>
                <h3 className="mb-3 border-b border-primary/20 pb-2 text-xl font-semibold dark:border-primary/30">
                  MÃ©todo de pago
                </h3>
                <div className="flex items-center justify-between rounded-lg bg-primary/10 p-4 dark:bg-primary/20">
                  <p className="font-medium">{methodLabel}</p>
                  <Link
                    to="/payment"
                    className="text-sm text-primary hover:opacity-90"
                  >
                    Cambiar
                  </Link>
                </div>
              </div>

              {err && (
                <p className="rounded-md border border-red-500/40 bg-red-500/10 px-3 py-2 text-sm text-red-300">
                  {err}
                </p>
              )}

              <button
                onClick={onConfirm}
                disabled={submitting}
                className="w-full rounded-lg bg-primary py-3 text-sm font-bold text-white hover:bg-primary/90 disabled:opacity-60"
              >
                {submitting ? "Procesando..." : "Confirmar pedido"}
              </button>
            </section>
          </aside>
        </div>
      </div>
    </main>
  );
}

----- FILE: .\src\pages\Contact.jsx -----
export default function Contact() {
  return (
    <main className="bg-background-light dark:bg-background-dark text-stone-800 dark:text-stone-200">
      <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-16">
        <h1 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-center">Contact Us</h1>
        <p className="mt-4 text-center text-stone-500 dark:text-stone-400">
          Weâ€™re here to help. Reach out with any questions or feedback.
        </p>

        {/* 2 columnas lado a lado a partir de md */}
        <div className="mt-12 grid grid-cols-1 md:grid-cols-2 gap-12 lg:gap-16 items-start">
          {/* Formulario (izquierda) */}
          <form className="rounded-xl bg-primary/10 p-8 dark:bg-primary/20 space-y-4">
            <h2 className="text-2xl font-bold">Send us a message</h2>
            <div>
              <label className="block text-sm mb-1">Your Name</label>
              <input className="w-full rounded-md border border-primary/30 bg-background-light dark:bg-background-dark p-3" />
            </div>
            <div>
              <label className="block text-sm mb-1">Your Email</label>
              <input type="email" className="w-full rounded-md border border-primary/30 bg-background-light dark:bg-background-dark p-3" />
            </div>
            <div>
              <label className="block text-sm mb-1">Subject</label>
              <input className="w-full rounded-md border border-primary/30 bg-background-light dark:bg-background-dark p-3" />
            </div>
            <div>
              <label className="block text-sm mb-1">Message</label>
              <textarea rows="5" className="w-full rounded-md border border-primary/30 bg-background-light dark:bg-background-dark p-3" />
            </div>
            <button type="submit" className="w-full rounded-lg bg-primary py-3 font-semibold text-white hover:bg-primary/90">
              Send Message
            </button>
          </form>

          {/* Info + mapa (derecha) */}
          <div className="space-y-10">
            <section>
              <h3 className="text-xl font-bold">Contact Information</h3>
              <div className="mt-3 space-y-1 text-stone-600 dark:text-stone-400">
                <p><strong>Phone:</strong> (555) 123-4567</p>
                <p><strong>Email:</strong> contacto@stringandsoul.com</p>
              </div>
            </section>

            <section>
              <h3 className="text-xl font-bold">Our Location</h3>
              <div className="mt-4 h-[360px] w-full overflow-hidden rounded-xl ring-1 ring-white/10">
                <iframe
                  src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d105073.45340254843!2d-58.51569879470437!3d-34.61565476986264!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x95bcca3b4ef90cbd%3A0xa0b3812e88e88e87!2sBuenos%20Aires%2C%20Cdad.%20Aut%C3%B3noma%20de%20Buenos%20Aires!5e0!3m2!1ses-419!2sar!4v1760569650881!5m2!1ses-419!2sar"
                  width="100%" height="100%" style={{ border: 0 }}
                  allowFullScreen="" loading="lazy" referrerPolicy="no-referrer-when-downgrade"
                />
              </div>
              <p className="mt-3 text-stone-500 dark:text-stone-400">
                Visit us in the heart of Buenos Aires.
              </p>
            </section>
          </div>
        </div>
      </div>
    </main>
  );
}

----- FILE: .\src\pages\FAQ.jsx -----
// src/pages/FAQ.jsx
import { useRef, useState, useEffect } from "react";

function Item({ i, q, a, active, onToggle }) {
  const ref = useRef(null);
  const [h, setH] = useState(0);
  useEffect(() => { if (ref.current) setH(active ? ref.current.scrollHeight : 0); }, [active]);

  return (
    <div className="overflow-hidden rounded-xl ring-1 ring-primary/20 bg-transparent">
      {/* header sin blanco */}
      <button
        onClick={() => onToggle(i)}
        aria-expanded={active}
        aria-controls={`faq-${i}`}
        className="flex w-full items-center justify-between px-5 py-4 bg-transparent hover:bg-primary/10 text-left"
      >
        <span className="font-semibold text-primary">{q}</span>
        <svg
          className={`h-5 w-5 text-primary transition-transform ${active ? "rotate-180" : ""}`}
          viewBox="0 0 256 256" fill="currentColor"
        >
          <path d="M213.7 101.7l-80 80a8 8 0 01-11.4 0l-80-80A8 8 0 0153.7 90.3L128 164.7l74.3-74.4a8 8 0 0111.4 11.4z"/>
        </svg>
      </button>

      {/* panel con mismo tono, no blanco */}
      <div
        id={`faq-${i}`}
        style={{ height: h }}
        className="overflow-hidden transition-[height] duration-300 ease-out bg-primary/10"
      >
        <div ref={ref} className="px-7 pt-7 pb-7 text-stone-300">
          {a}
        </div>
      </div>
    </div>
  );
}

export default function FAQ() {
  const faqs = [
    { q: "Â¿CÃ³mo hago un pedido?", a: "AgregÃ¡ productos al carrito y continuÃ¡ al checkout." },
    { q: "Â¿QuÃ© mÃ©todos de pago aceptan?", a: "Tarjetas de crÃ©dito, dÃ©bito y PayPal." },
    { q: "Â¿Puedo cancelar mi pedido?", a: "SÃ­, dentro de las 24 h si aÃºn no fue enviado." },
    { q: "Â¿CuÃ¡nto tarda el envÃ­o?", a: "EnvÃ­o estÃ¡ndar 3â€“7 dÃ­as hÃ¡biles segÃºn tu zona." },
    { q: "Â¿Tienen garantÃ­a?", a: "GarantÃ­a limitada por defectos de fÃ¡brica." },
  ];
  const [open, setOpen] = useState(null);
  const toggle = (i) => setOpen((v) => (v === i ? null : i));

  return (
    <main className="bg-background-light dark:bg-background-dark text-stone-200">
      <div className="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-14">
        <h1 className="text-4xl font-extrabold text-center">Preguntas Frecuentes</h1>
        <p className="mt-3 text-center text-stone-400">
          Â¿No encontrÃ¡s tu respuesta? Escribinos a <a className="text-primary" href="mailto:soporte@stringandsoul.com">soporte@stringandsoul.com</a>.
        </p>

        <div className="mt-8 space-y-4">
          {faqs.map((f, i) => (
            <Item key={i} i={i} q={f.q} a={f.a} active={open === i} onToggle={toggle} />
          ))}
        </div>
      </div>
    </main>
  );
}

----- FILE: .\src\pages\Home.jsx -----
import { Link } from "react-router-dom";

export default function Home() {
  return (
    <main className="flex-1">
      {/* HERO */}
      <section className="py-16 md:py-30">
        <div className="mx-auto w-8xl px-4 sm:px-6 lg:px-8">
          <div
            className="relative flex min-h-[600px] items-center justify-center overflow-hidden rounded-xl bg-cover bg-center p-8 text-center"
            style={{
              backgroundImage:
                'linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.5)), url("https://lh3.googleusercontent.com/aida-public/AB6AXuBSfetmgcEEAPqxn90x0d4neJA5JipPFfgpYlgL4mU2dKmIghVxndjkaq_klTgQVjHsWal3yO9o1IKNbR_WlUwcOkVT5GxkLOArd0l_sbF4r81vrV8F4bLuy1emgFGZrWH8clsIvvJRXez3BSAE2C_YKuDPPTzCmDfFGBObaYgrttUmJjMSzuXO_0UcR7hSc9kbXRKJFZ2o8hfPZgYF82bWBjAj8WuE-KZY1mSHVbSfcwiAZBIOJMsOC3b_zDSfJAlIg1P17Bujblc")',
            }}
          >
            <div className="flex flex-col items-center gap-6">
              <div className="flex flex-col gap-2 text-white">
                <h1 className="text-4xl font-extrabold md:text-6xl">
                  Find Your Perfect Sound
                </h1>
                <p className="text-base font-light md:text-lg">
                  Explore our curated collection of guitars, crafted for every style and skill level.
                </p>
              </div>
              <Link
                to="/catalog"
                className="rounded-lg bg-primary px-8 py-3 text-base font-bold text-white transition hover:bg-primary/80"
              >
                Shop Now
              </Link>
            </div>
          </div>
        </div>
      </section>
   {/* FEATURED */}
<section className="py-12 md:py-16">
  <div className="mx-auto max-w-8xl px-4 sm:px-6 lg:px-8">
    <h2 className="text-2xl font-bold text-stone-900 dark:text-white">Featured Guitars</h2>

    <div className="mt-6 grid grid-cols-3 gap-6 md:grid-cols-2 lg:grid-cols-3">
      {[
        {
          title: "The 'Prairie Song' Acoustic",
          text: "Warm tones and classic design, perfect for folk and country.",
          img: "https://lh3.googleusercontent.com/aida-public/AB6AXuCbyAw1shFLNrByQTuJUfCswlhCQApIemwNPM1O9P_L30Gummo2qXrqGX4rpy-dSoC7iVKjZP6oZLtCwQ7txo_v5fKQbgJul8944hF7ZvFJor6rhY4wUIgT8GGsyOxEXChvybbfR2TGsR-t21WoBtNc4t14wzllEKCIxL-Zw6C-8t6px-9WpxdSo93y0jjPns69pWTI6hgeimgsjOhpgnLwkLndL9Oz7sTHVfCzOaQ66ft88TiyanXcoE8hENaJHnzAOKO8xcjQCDg",
        },
        {
          title: "The 'Midnight Rider' Electric",
          text: "Powerful sound and sleek design, ideal for rock and blues.",
          img: "https://lh3.googleusercontent.com/aida-public/AB6AXuDc3YoEwzEII_0C0dsYKn16VYxIJZR7WOgIxADOQ36c64hGUn1XhqMxDNAZhvPiPpOFllp6XHQ-eOgThgVclm02ZUnE7aNuxAgrTKfVTjMuydjVjNQAIaovP4PXuP531hRKBDkGGFH4BmiGweHxAxF85q_TDjuTkoYgsTg-aI4VKnYhMp0B1NlUCCJCiCzSvPnIfVxW-x8v5qUcnV_p2ytLQwkk0R0zi0q5X8YS1977ovB9aITY-rJx9K0FT_d3-BqvMiJkc6FXOLk",
        },
        {
          title: "The 'Thunder Road' Bass",
          text: "Deep, resonant bass with a comfortable feel for any genre.",
          img: "https://lh3.googleusercontent.com/aida-public/AB6AXuBMVm6UaGcXN1cCxCC9Hx6Cv6HTkhWExLmaCBubUrqrbtYSj8bgz7SlVA7cgjlSeuBu5mR3DobuEzhKFvnapIjF68bb2CZQjpDlltmLJ2oZpcS6JzFM4I7wPPLShxA5t8mDRnSYqsmwMmFjaOMTVaS79qf9deXtOXrRHNxTP76w6muc-Rwr1MD8X8kVvk63snTzlbL3ypF60ZkUX6z0g2lF60inSdAjCOUNngLqI314t2iEcn1E9TtJp78IM-qAxncnVx3BALf1kKA",
        },
      ].map((c) => (
        <article key={c.title} className="group overflow-hidden rounded-xl border border-white/10">
          <div className="h-56 md:h-64 w-full overflow-hidden">
            <img
              src={c.img}
              alt={c.title}
              className="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
              loading="lazy"
            />
          </div>
          <div className="p-4">
            <h3 className="font-semibold text-stone-900 dark:text-white">{c.title}</h3>
            <p className="text-sm text-stone-600 dark:text-stone-400">{c.text}</p>
          </div>
        </article>
      ))}
    </div>
  </div>
</section>


{/* CATEGORIES */}
<section className="py-12 md:py-16">
  <div className="mx-auto max-w-8xl px-4 sm:px-6 lg:px-8">
    <h2 className="text-2xl font-bold text-stone-900 dark:text-white">Shop by Category</h2>

    <div className="mt-6 grid grid-cols-4 gap-6 md:grid-cols-4">
      {[
        {
          title: "Guitars",
          text: "Explore our range of guitars.",
          img: "https://lh3.googleusercontent.com/aida-public/AB6AXuDJrIylck-_TSgSDirpXHOfdt1uv835vHVw3odnmBaNB_lcYNckSLAlmFoK_eXrrsjG8C0c2irKLty2K5Nhfg_EyiYEy8EMTSo0Wy092fXNr2heG3F40q1hzqALMGnIZ6SdImImWd5aa5-yfmTvUgesyIJqiL4WBL1rvln95_YCA_M1eG4Mh-s55WU_B3XSiJuE8iIyxJH2ALWDJvzCdubVW7KA3wdaSOvU68T_B2_eBJUKqCnfGvujSmvero-vhOmSsvIRRpeiKZM",
          to: "/catalog?",
        },
        {
          title: "Electric Guitars",
          text: "Discover our selection of electric guitars.",
          img: "https://lh3.googleusercontent.com/aida-public/AB6AXuAZh1SmUPXygK5USePgwL7LPF4vHkS1QIHzyVbs1jbHXtQ-wJIkH2BoRPJwX1YKY9BAYfJ4sdru-FOtytDlZmyOyTv0i8bQUUBdnWmZ4fS2l_o243vL9gVU801I_5iGNMLb4u8xbtrS41hdOftpb2pPtoAjfvEv9cFH4R_Q50wBKFE8eD7RBACwRXLQSOBC8GsBMiar8wNKtq-r8gIKRB2Td7Byowz4F3pJ5QM3A8OtJ5sScjHAEcI6Sg0G7hLR2t_p_FdZz_MSLZE",
          to: "/catalog?cat=electric",
        },
        {
          title: "Bass Guitars",
          text: "Find the perfect bass guitar for your style.",
          img: "https://lh3.googleusercontent.com/aida-public/AB6AXuDqnpHQE5yhMjM5ZOSN1dQUs-aGIgzx4iMtTyk3J1pcIYwH8by3PyAx02riMLYf7OIn-KuP43RtnL_qNkIRzQS2Sv852HnAAlNFnUmZhF39yzc30W80GKjBhK2hhJl_PLvX0nsOgiWgCJYFRyUYwSywt0LUEPsIi9VGG_cDCtmyYejC72HEqFOmYAym8Iyv4If-5LaVNsF0ZwaVZ_56qtqe1ZN3fnrtW38IJbWFRDQ9HlnM4AeoGFLYZA-_IWU9mhQoLoIBaBGMWvA",
          to: "/catalog?cat=bass",
        },
        {
          title: "Acoustic Guitars",
          text: "Explore our range of acoustic guitars.",
          img: "https://lh3.googleusercontent.com/aida-public/AB6AXuDJrIylck-_TSgSDirpXHOfdt1uv835vHVw3odnmBaNB_lcYNckSLAlmFoK_eXrrsjG8C0c2irKLty2K5Nhfg_EyiYEy8EMTSo0Wy092fXNr2heG3F40q1hzqALMGnIZ6SdImImWd5aa5-yfmTvUgesyIJqiL4WBL1rvln95_YCA_M1eG4Mh-s55WU_B3XSiJuE8iIyxJH2ALWDJvzCdubVW7KA3wdaSOvU68T_B2_eBJUKqCnfGvujSmvero-vhOmSsvIRRpeiKZM",
          to: "/catalog?cat=acoustic",
        },
       
      ].map((c) => (
        <Link key={c.title} to={c.to} className="group block overflow-hidden rounded-xl">
          <div className="h-56 md:h-64 w-full overflow-hidden rounded-lg">
            <img
              src={c.img}
              alt={c.title}
              className="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
              loading="lazy"
            />
          </div>
          <div className="mt-3">
            <h3 className="font-semibold text-stone-900 dark:text-white">{c.title}</h3>
            <p className="text-sm text-stone-600 dark:text-stone-400">{c.text}</p>
          </div>
        </Link>
      ))}
    </div>
  </div>
</section>
    </main>
  );
}


----- FILE: .\src\pages\Login.jsx -----
// src/pages/Login.jsx
import { useState, useEffect } from "react";
import { Link, useNavigate, useLocation } from "react-router-dom";
import { api } from "../lib/api.js";
import { useAuth } from "../context/AuthContext.jsx";

export default function Login() {
  const navigate = useNavigate();
  const location = useLocation();
  const { login } = useAuth();

  const [form, setForm] = useState({ email: "", password: "" });
  const [remember, setRemember] = useState(false);
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);

  // precarga email si se marcÃ³ "Recordarme" antes
  useEffect(() => {
    const saved = localStorage.getItem("remember_email");
    if (saved) {
      setForm((f) => ({ ...f, email: saved }));
      setRemember(true);
    }
  }, []);

  const onChange = (e) => {
    const { name, value, type, checked } = e.target;
    if (type === "checkbox") setRemember(checked);
    else setForm((f) => ({ ...f, [name]: value }));
  };

  const onSubmit = async (e) => {
    e.preventDefault();
    setError("");
    setLoading(true);
    try {
      const { accessToken } = await api.login({
        email: form.email,
        password: form.password,
      });
      // guarda token en AuthContext + localStorage
      login(accessToken);

      // persiste email si "Recordarme" estÃ¡ activo
      if (remember) localStorage.setItem("remember_email", form.email);
      else localStorage.removeItem("remember_email");

      // redirige a ruta previa o a /account
      const to = location.state?.from || "/account";
      navigate(to, { replace: true });
    } catch (err) {
      setError(err.message || "Credenciales invÃ¡lidas");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="flex min-h-[70vh] items-center justify-center px-4 py-12 sm:py-20">
      <div className="w-full max-w-xl">
        <div className="rounded-xl bg-[#14100b] p-6">
          <h2 className="mb-2 text-2xl font-semibold text-stone-900 dark:text-white">
            Bienvenido de nuevo
          </h2>
          <p className="mb-6 text-sm text-stone-600 dark:text-stone-300">
            Inicia sesiÃ³n con tu cuenta para continuar
          </p>

          <form className="space-y-6" onSubmit={onSubmit}>
            <label className="block">
              <span className="text-sm text-stone-700 dark:text-stone-200">E-mail</span>
              <input
                type="email"
                name="email"
                required
                className="mt-1 block w-full rounded-md border border-stone-200 bg-white px-3 py-2 text-sm shadow-sm placeholder:text-stone-400 focus:outline-none focus:ring-2 focus:ring-primary dark:border-stone-700 dark:bg-stone-800 dark:text-stone-100"
                placeholder="tu@ejemplo.com"
                value={form.email}
                onChange={onChange}
              />
            </label>

            <label className="block">
              <span className="text-sm text-stone-700 dark:text-stone-200">ContraseÃ±a</span>
              <input
                type="password"
                name="password"
                required
                className="mt-1 block w-full rounded-md border border-stone-200 bg-white px-3 py-2 text-sm shadow-sm placeholder:text-stone-400 focus:outline-none focus:ring-2 focus:ring-primary dark:border-stone-700 dark:bg-stone-800 dark:text-stone-100"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                value={form.password}
                onChange={onChange}
              />
            </label>

            <div className="flex items-center justify-between">
              <label className="flex items-center gap-2 text-sm text-stone-700 dark:text-stone-300">
                <input
                  type="checkbox"
                  className="h-4 w-4 rounded border-stone-300 bg-white text-primary focus:ring-primary"
                  checked={remember}
                  onChange={onChange}
                />
                <span>Recordarme</span>
              </label>
              <Link to="#" className="text-sm text-primary hover:underline">
                Â¿Olvidaste la contraseÃ±a?
              </Link>
            </div>

            <button
              type="submit"
              disabled={loading}
              className="w-full rounded-md bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm hover:opacity-95"
            >
              {loading ? "Ingresando..." : "Iniciar sesiÃ³n"}
            </button>

            {error && <p className="text-center text-red-500 text-sm">{error}</p>}
          </form>

          <p className="mt-6 text-center text-sm text-stone-600 dark:text-stone-300">
            Â¿No tenÃ©s cuenta?{" "}
            <Link to="/register" className="font-medium text-primary hover:underline">
              Registrate
            </Link>
          </p>
        </div>
      </div>
    </div>
  );
}

----- FILE: .\src\pages\NotFound.jsx -----

----- FILE: .\src\pages\Payment.jsx -----
// src/pages/Payment.jsx
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { useShop } from "../context/ShopContext.jsx";

const fmt = (n) =>
  new Intl.NumberFormat("es-AR", {
    style: "currency",
    currency: "USD",
    minimumFractionDigits: 0,
  }).format(Number(n || 0));

export default function Payment() {
  const nav = useNavigate();
  const { state, priceWithDiscount } = useShop();

  const items = state.cart ?? [];
  const total = items.reduce((t, i) => t + priceWithDiscount(i) * i.qty, 0);

  const [method, setMethod] = useState("credit"); // "credit" | "debit" | "cash"
  const [card, setCard] = useState({ number: "", exp: "", cvv: "", name: "" });

 // Payment.jsx
const submit = (e) => {
  e.preventDefault();
  if (!items.length) return;

  // normaliza mÃ©todo: "credit" | "debit" | "cash"
  const m = method;

  // toma Ãºltimos 4 si es tarjeta
  const last4 =
    m === "cash"
      ? ""
      : (card.number || "").replace(/\D/g, "").slice(-4);

  localStorage.setItem("payment.method", m);
  localStorage.setItem("payment.last4", last4);

  nav("/checkout-final");
};



  return (
    <div className="flex min-h-[80vh] items-start justify-center">
      <main className="w-full max-w-3xl px-4 py-10 sm:px-6 lg:px-8">
        <h1 className="mb-6 text-3xl font-bold">MÃ©todo de pago</h1>

        <form onSubmit={submit} className="space-y-8">
          {/* MÃ©todos */}
          <div className="space-y-3">
            {[
              { id: "credit", label: "CrÃ©dito" },
              { id: "debit", label: "DÃ©bito" },
              { id: "cash",  label: "Efectivo al entregar" },
            ].map((opt) => (
              <label
                key={opt.id}
                className={`flex cursor-pointer items-center justify-between rounded-lg border px-4 py-4 ${
                  method === opt.id
                    ? "border-primary/60 bg-primary/10"
                    : "border-white/10 bg-transparent"
                }`}
              >
                <div className="flex items-center gap-3">
                  <input
                    type="radio"
                    name="method"
                    value={opt.id}
                    checked={method === opt.id}
                    onChange={() => setMethod(opt.id)}
                    className="h-4 w-4 accent-primary"
                  />
                  <span className="text-sm">{opt.label}</span>
                </div>
              </label>
            ))}
          </div>

          {/* Contenido por mÃ©todo */}
          {method === "cash" ? (
            <div className="rounded-lg border border-white/10 p-5">
              <div className="mb-3 flex items-center justify-between text-lg font-semibold">
                <span>Total</span>
                <span>{fmt(total)}</span>
              </div>
              <p className="text-sm opacity-80">
                RecordÃ¡ tener billetes en buen estado y pagar justo en lo posible.
              </p>
            </div>
          ) : (
            <div className="space-y-5">
              <div>
                <label className="mb-2 block text-sm opacity-80">NÃºmero de tarjeta</label>
                <input
                  inputMode="numeric"
                  placeholder="0000 0000 0000 0000"
                  value={card.number}
                  onChange={(e) => setCard((c) => ({ ...c, number: e.target.value }))}
                  className="w-full rounded-lg border border-white/10 bg-transparent px-4 py-3"
                  required={method !== "cash"}
                  disabled={method === "cash"}
                />
              </div>

              <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
                <div>
                  <label className="mb-2 block text-sm opacity-80">Vencimiento</label>
                  <input
                    placeholder="MM/AA"
                    value={card.exp}
                    onChange={(e) => setCard((c) => ({ ...c, exp: e.target.value }))}
                    className="w-full rounded-lg border border-white/10 bg-transparent px-4 py-3"
                    required={method !== "cash"}
                    disabled={method === "cash"}
                  />
                </div>
                <div>
                  <label className="mb-2 block text-sm opacity-80">CVV</label>
                  <input
                    placeholder="123"
                    value={card.cvv}
                    onChange={(e) => setCard((c) => ({ ...c, cvv: e.target.value }))}
                    className="w-full rounded-lg border border-white/10 bg-transparent px-4 py-3"
                    required={method !== "cash"}
                    disabled={method === "cash"}
                  />
                </div>
                <div>
                  <label className="mb-2 block text-sm opacity-80">Nombre en la tarjeta</label>
                  <input
                    placeholder="Nombre y Apellido"
                    value={card.name}
                    onChange={(e) => setCard((c) => ({ ...c, name: e.target.value }))}
                    className="w-full rounded-lg border border-white/10 bg-transparent px-4 py-3"
                    required={method !== "cash"}
                    disabled={method === "cash"}
                  />
                </div>
              </div>
            </div>
          )}

          <button
            type="submit"
            disabled={!items.length}
            className="w-full rounded-lg bg-primary py-3 font-semibold text-white hover:brightness-110 disabled:opacity-50"
          >
            Confirmar pago
          </button>
        </form>
      </main>
    </div>
  );
}

----- FILE: .\src\pages\ProductDetail.jsx -----
// src/pages/ProductDetail.jsx
import { useEffect, useMemo, useState } from "react";
import { useParams, Link } from "react-router-dom";
import { useShop } from "../context/ShopContext.jsx";
import { useAuth } from "../context/AuthContext.jsx";

const BASE = import.meta.env.VITE_API_URL;

const fmt = (n) =>
  new Intl.NumberFormat("en-US", { style: "currency", currency: "USD", maximumFractionDigits: 0 })
    .format(Number(n || 0));

export default function ProductDetail() {
  const { id } = useParams();
  const { state, priceWithDiscount, api, addToCart } = useShop();
  const { isAdmin } = useAuth(); // â† solo JWT

  const fromStore = state.products.find((x) => String(x.id) === String(id));
  const [remote, setRemote] = useState(null);
  const [loading, setLoading] = useState(!fromStore);
  const [err, setErr] = useState("");

  useEffect(() => {
    if (fromStore) return;
    let alive = true;
    (async () => {
      try {
        const dto = await api.getProduct(id);
        if (!alive) return;
        setRemote(dto);
      } catch (e) {
        if (!alive) return;
        setErr(e.message || "Error cargando producto");
      } finally {
        if (alive) setLoading(false);
      }
    })();
    return () => { alive = false; };
  }, [id, fromStore, api]);

  const p = fromStore || remote;

  const images = useMemo(() => {
    const arr = Array.isArray(p?.images) ? p.images : [];
    return arr.map((it) =>
      typeof it === "string" ? it : (it?.url || `${BASE}/api/products/${p?.id}/images/${it?.id}`)
    );
  }, [p]);

  const hero = p?.image || images[0];
  const thumbs = p?.gallery?.length ? p.gallery : images.slice(1, 4);
  const final = p ? priceWithDiscount(p) : 0;

  if (loading) return <main className="mx-auto max-w-7xl p-6 text-stone-300">Cargandoâ€¦</main>;
  if (err) return <main className="mx-auto max-w-7xl p-6 text-red-400">{err}</main>;
  if (!p) return <main className="mx-auto max-w-7xl p-6">Producto no encontrado.</main>;

  const handleAdd = () => addToCart(p);

  return (
    <main className="w-full py-8">
      <div className="mx-auto max-w-8xl px-10 sm:px-16 lg:px-24">
        <div className="grid gap-10 md:grid-cols-12">
          <section className="md:col-span-6">
            <div className="overflow-hidden rounded-xl bg-stone-200 dark:bg-stone-800">
              {hero ? (
                <img src={hero} alt={p.name} className="w-full object-cover" style={{ aspectRatio: "5 / 3" }} />
              ) : <div className="h-[300px] w-full" /> }
            </div>

            {!!thumbs.length && (
              <div className="mt-4 grid grid-cols-3 gap-3">
                {thumbs.map((g, i) => (
                  <div key={i} className="overflow-hidden rounded-lg bg-stone-200 dark:bg-stone-800">
                    <img src={g} alt={`${p.name}-${i}`} className="h-full w-full object-cover" style={{ aspectRatio: "4 / 3" }} />
                  </div>
                ))}
              </div>
            )}
          </section>

          <aside className="md:col-span-5">
            <div className="flex items-baseline justify-between gap-4">
              <h1 className="text-3xl font-bold">{p.name}</h1>
              {isAdmin && (
                <Link
                  to={`/admin/products/${p.id}/edit`}
                  className="rounded bg-primary/20 px-3 py-1 text-sm font-semibold text-primary hover:bg-primary/30"
                >
                  Editar
                </Link>
              )}
            </div>

            <div className="mt-4">
              <div className="text-2xl font-extrabold text-primary">{fmt(final)}</div>
              {p.discount ? <div className="text-sm opacity-60 line-through">{fmt(p.price)}</div> : null}
            </div>

            <div className="mt-5 flex gap-6">
              <button
                onClick={handleAdd}
                disabled={(p.stock ?? 0) <= 0}
                className="rounded-lg bg-primary px-40 py-2 font-semibold text-white hover:bg-primary/80 disabled:opacity-50"
              >
                Add to Cart
              </button>
              <span className="self-center text-sm opacity-70">
                {(p.stock ?? 0) > 0 ? `${p.stock} en stock` : "Sin stock"}
              </span>
            </div>

            <section className="mt-8">
              <h2 className="mb-2 text-lg font-bold">Description</h2>
              <p className="opacity-80">{p.short || p.description || "â€”"}</p>
            </section>

            <section className="mt-8">
              <h2 className="mb-2 text-lg font-bold">Specifications</h2>
              <dl className="divide-y divide-white/10 rounded-lg">
                {[
                  ["Top Wood", p.topWood || p.woodTop],
                  ["Back & Sides", p.backSides || p.wood],
                  ["Neck", p.neck],
                  ["Fretboard", p.fretboard],
                  ["Scale", p.scale],
                  ["Nut Width", p.nutWidth],
                  ["Finish", p.finish],
                ]
                  .filter(([, v]) => v)
                  .map(([k, v], i) => (
                    <div
                      key={k}
                      className={`grid grid-cols-2 gap-4 px-4 py-3 ${i === 0 ? "border-t border-white/10" : ""} border-b border-white/10`}
                    >
                      <dt className="opacity-70">{k}</dt>
                      <dd className="text-right">{v}</dd>
                    </div>
                  ))}
              </dl>
            </section>
          </aside>

          <section className="md:col-span-12 mt-8">
            <h2 className="text-lg font-bold mb-3">Customer Reviews</h2>
            {p.reviews && p.reviews.length > 0 ? (
              <>
                {(() => {
                  const total = p.reviews.length;
                  const avg = p.reviews.reduce((s, r) => s + r.rating, 0) / total;
                  const counts = [5, 4, 3, 2, 1].map((n) => p.reviews.filter((r) => r.rating === n).length);
                  return (
                    <div className="mt-4 grid gap-4 rounded-lg border border-white/10 p-4 md:grid-cols-[160px,1fr]">
                      <div>
                        <div className="text-3xl font-bold">{avg.toFixed(1)}</div>
                        <div className="text-sm opacity-70">based on {total} review{total !== 1 ? "s" : ""}</div>
                      </div>
                      <div className="space-y-2">
                        {[5,4,3,2,1].map((n,i) => {
                          const percent = total > 0 ? (counts[i] / total) * 100 : 0;
                          return (
                            <div key={n} className="flex items-center gap-3">
                              <span className="w-6 text-sm">{n}â˜…</span>
                              <div className="h-2 flex-1 rounded bg-stone-700">
                                <div className="h-2 rounded bg-amber-500 transition-all" style={{ width: `${percent}%` }} />
                              </div>
                              <span className="w-10 text-right text-xs opacity-70">{percent.toFixed(0)}%</span>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  );
                })()}
                <div className="mt-6 space-y-4">
                  {p.reviews.map((r, i) => (
                    <div key={i} className="rounded-lg border border-white/10 p-4 shadow-sm">
                      <div className="mb-1 flex items-center justify-between">
                        <h4 className="font-semibold">{r.user}</h4>
                        <div className="flex text-amber-500">
                          {Array.from({ length: 5 }).map((_, idx) => <span key={idx}>{idx < r.rating ? "â˜…" : "â˜†"}</span>)}
                        </div>
                      </div>
                      <p className="text-sm opacity-90">{r.comment}</p>
                      <p className="mt-1 text-xs opacity-60">{r.date}</p>
                    </div>
                  ))}
                </div>
              </>
            ) : (
              <div className="rounded-lg border border-white/10 p-4 text-sm opacity-80">
                TodavÃ­a no hay reseÃ±as para este producto.
              </div>
            )}
          </section>
        </div>
      </div>
    </main>
  );
}

----- FILE: .\src\pages\Register.jsx -----
// src/pages/Register.jsx
import { useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import { api } from "../lib/api.js";
import { useAuth } from "../context/AuthContext.jsx";

export default function Register() {
  const navigate = useNavigate();
  const { login } = useAuth();
  const [form, setForm] = useState({
    firstName: "",
    lastName: "",
    email: "",
    password: "",
    confirm: "",
  });
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);

  const onChange = (e) => {
    const { name, value } = e.target;
    setForm((f) => ({ ...f, [name]: value }));
  };

  const onSubmit = async (e) => {
    e.preventDefault();
    setError("");

    if (form.password !== form.confirm) {
      setError("Las contraseÃ±as no coinciden");
      return;
    }

    setLoading(true);
    try {
      const dto = {
        firstName: form.firstName.split(" ")[0] || form.firstName,
        lastName: form.lastName.split(" ")[1] || "",
        email: form.email,
        password: form.password,
        role: "USER",
      };
      const { accessToken } = await api.register(dto);
      login(accessToken); // guarda token en localStorage
      navigate("/account"); // redirige
    } catch (err) {
      setError(err.message || "Error al registrarse");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="flex min-h-[70vh] items-center justify-center px-4 py-12 sm:py-20">
      <div className="w-full max-w-xl">
        <div className="rounded-xl bg-[#14100b] p-6">
          <h2 className="mb-2 text-2xl font-semibold text-stone-900 dark:text-white">
            Crea tu cuenta
          </h2>
          <p className="mb-6 text-sm text-stone-600 dark:text-stone-300">
            RegÃ­strate para acceder a ventas, listas y tu cuenta
          </p>

          <form onSubmit={onSubmit} className="grid gap-6">
            <div>
              <label className="block text-sm text-stone-700 dark:text-stone-200">
                Nombre completo
              </label>
              <input
                type="text"
                name="firstName"
                required
                className="mt-1 block w-full rounded-md border border-stone-200 px-3 py-2 text-sm placeholder:text-stone-400 focus:outline-none focus:ring-2 focus:ring-primary dark:border-stone-700 dark:bg-stone-800 dark:text-stone-100"
                placeholder="Tu nombre"
                value={form.firstName}
                onChange={onChange}
              />
            </div>

            <div>
              <label className="block text-sm text-stone-700 dark:text-stone-200">
                E-mail
              </label>
              <input
                type="email"
                name="email"
                required
                className="mt-1 block w-full rounded-md border border-stone-200 px-3 py-2 text-sm placeholder:text-stone-400 focus:outline-none focus:ring-2 focus:ring-primary dark:border-stone-700 dark:bg-stone-800 dark:text-stone-100"
                placeholder="tu@ejemplo.com"
                value={form.email}
                onChange={onChange}
              />
            </div>

            <div className="grid gap-4 sm:grid-cols-2">
              <div>
                <label className="block text-sm text-stone-700 dark:text-stone-200">
                  ContraseÃ±a
                </label>
                <input
                  type="password"
                  name="password"
                  required
                  className="mt-1 block w-full rounded-md border border-stone-200 px-3 py-2 text-sm placeholder:text-stone-400 focus:outline-none focus:ring-2 focus:ring-primary dark:border-stone-700 dark:bg-stone-800 dark:text-stone-100"
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  value={form.password}
                  onChange={onChange}
                />
              </div>
              <div>
                <label className="block text-sm text-stone-700 dark:text-stone-200">
                  Confirmar contraseÃ±a
                </label>
                <input
                  type="password"
                  name="confirm"
                  required
                  className="mt-1 block w-full rounded-md border border-stone-200 px-3 py-2 text-sm placeholder:text-stone-400 focus:outline-none focus:ring-2 focus:ring-primary dark:border-stone-700 dark:bg-stone-800 dark:text-stone-100"
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  value={form.confirm}
                  onChange={onChange}
                />
              </div>
            </div>

            <button
              type="submit"
              disabled={loading}
              className="mt-2 w-full rounded-md bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm hover:opacity-95"
            >
              {loading ? "Creando cuenta..." : "Crear cuenta"}
            </button>

            {error && (
              <p className="text-center text-red-500 text-sm">{error}</p>
            )}
          </form>

          <p className="mt-6 text-center text-sm text-stone-600 dark:text-stone-300">
            Â¿Ya tenÃ©s una cuenta?{" "}
            <Link
              to="/login"
              className="font-medium text-primary hover:underline"
            >
              Iniciar sesiÃ³n
            </Link>
          </p>
        </div>
      </div>
    </div>
  );
}

----- FILE: .\src\pages\Search.jsx -----
import { useEffect, useMemo, useState } from "react";
import { useLocation, useNavigate, Link } from "react-router-dom";
import { useShop } from "../context/ShopContext.jsx";
import ProductCard from "../components/ProductCard.jsx";
import Pagination from "../components/Pagination.jsx";

const norm = (s = "") => s.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu, "");

export default function Search() {
  const { state } = useShop();
  const nav = useNavigate();
  const { search } = useLocation();
  const sp = useMemo(() => new URLSearchParams(search), [search]);

  const qParam = sp.get("q") || "";
  const pageParam = Number(sp.get("page") || 1);

  const [q, setQ] = useState(qParam);
  useEffect(() => setQ(qParam), [qParam]);

  const results = useMemo(() => {
    const qn = norm(qParam);
    if (!qn) return [];
    return (state?.products ?? []).filter((p) => {
      const text = `${p.name} ${p.brand ?? ""} ${p.category ?? ""}`;
      return norm(text).includes(qn);
    });
  }, [state?.products, qParam]);

  // paginaciÃ³n
  const pageSize = 12;
  const total = results.length;
  const totalPages = Math.max(1, Math.ceil(total / pageSize));
  const page = Math.min(Math.max(1, pageParam), totalPages);
  const slice = results.slice((page - 1) * pageSize, page * pageSize);

  const onSubmit = (e) => {
    e.preventDefault();
    nav(`/search?q=${encodeURIComponent(q)}&page=1`);
  };

  return (
    <main className="mx-auto max-w-[1400px] px-6 py-10">
      <div className="grid gap-8 grid-cols-[280px,1fr]">
        {/* Sidebar visual para mantener la composiciÃ³n de la plantilla */}
        <aside className="rounded-xl border border-stone-800 bg-[#20160F] p-6 h-fit">
          <h2 className="text-xl font-bold text-stone-100">Filtrar por</h2>
          <div className="mt-6 text-stone-400 text-sm space-y-4">
            <section>
              <div className="font-semibold text-stone-300 mb-2">Marca</div>
              <ul className="space-y-2">
                {["Stringer", "Harmony", "Blue Ridge"].map((m) => (
                  <li key={m} className="flex items-center gap-2">
                    <input type="checkbox" className="h-4 w-4 rounded border-stone-600 bg-transparent text-amber-500" disabled />
                    {m}
                  </li>
                ))}
              </ul>
            </section>

            <section>
              <div className="font-semibold text-stone-300 mb-2">Tipo de Madera</div>
              <ul className="space-y-2 opacity-60">
                {["Caoba", "Arce", "Abeto"].map((m) => (
                  <li key={m} className="flex items-center gap-2">
                    <input type="checkbox" className="h-4 w-4 rounded border-stone-600" disabled />
                    {m}
                  </li>
                ))}
              </ul>
            </section>

            <section>
              <div className="font-semibold text-stone-300 mb-2">Color</div>
              <ul className="space-y-2 opacity-60">
                {["Natural", "Sunburst", "Negro"].map((m) => (
                  <li key={m} className="flex items-center gap-2">
                    <input type="checkbox" className="h-4 w-4 rounded border-stone-600" disabled />
                    {m}
                  </li>
                ))}
              </ul>
            </section>

            <section>
              <div className="font-semibold text-stone-300 mb-2">Rango de Precios</div>
              <input type="range" min="50" max="3000" defaultValue="800" className="h-1.5 w-full rounded-full bg-stone-700" disabled />
              <div className="mt-2 flex justify-between text-xs text-stone-500">
                <span>$50</span><span>$3000</span>
              </div>
            </section>
          </div>
        </aside>

        <section>
          <h1 className="text-4xl font-bold text-stone-100">Resultados de BÃºsqueda</h1>
          <p className="mt-2 text-sm text-stone-400">
            {qParam ? <>Mostrando resultados para <span className="italic">â€œ{qParam}â€</span></> : "Escribe un tÃ©rmino para buscar."}
          </p>


          {/* Grilla de resultados */}
          <div className="mt-10 grid gap-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
            {slice.map((p) => (
              <ProductCard key={p.id} p={p} />
            ))}
            {slice.length === 0 && <div className="text-stone-400">Sin resultados.</div>}
          </div>

          {/* PaginaciÃ³n */}
          {total > pageSize && (
            <div className="mt-8 flex items-center justify-center">
              <Pagination
                page={page}
                totalPages={totalPages}
                makeHref={(n) => `/search?q=${encodeURIComponent(qParam)}&page=${n}`}
              />
            </div>
          )}
        </section>
      </div>
    </main>
  );
}

----- FILE: .\src\router\ProtectedRoute.jsx -----
// src/router/ProtectedRoute.jsx
import { Navigate, useLocation } from "react-router-dom";
import { useAuth } from "../context/AuthContext.jsx";

export default function ProtectedRoute({ children, role }) {
  const { isAuth, isAdmin } = useAuth();
  const location = useLocation();

  if (role === "ADMIN") {
    return isAdmin ? children : <Navigate to="/login" replace state={{ from: location }} />;
  }
  return isAuth ? children : <Navigate to="/login" replace state={{ from: location }} />;
}

----- FILE: .\src\App.jsx -----
import { Routes, Route, Navigate } from "react-router-dom";
import NavBar from "./components/NavBar.jsx";
import Home from "./pages/Home.jsx";
import Catalog from "./pages/Catalog.jsx";
import ProductDetail from "./pages/ProductDetail.jsx";
import CartPage from "./pages/CartPage.jsx";
import Checkout from "./pages/Checkout.jsx";
import Login from "./pages/Login.jsx";
import Register from "./pages/Register.jsx";
import Account from "./pages/Account.jsx";
import About from "./pages/About.jsx";
import Footer from "./components/Footer.jsx";
import Contact from "./pages/Contact.jsx";
import FAQ from "./pages/FAQ.jsx";
import Search from "./pages/Search.jsx";
import Payment from "./pages/Payment.jsx";
import CheckoutFinal from "./pages/CheckoutFinal.jsx";
import ProtectedRoute from "./router/ProtectedRoute.jsx";
import AdminProducts from "./pages/AdminProducts.jsx";
import ProductEditor from "./pages/admin/ProductEditor.jsx"; // â† import importante

export default function App() {
  return (
    <>
      <NavBar />
      <div className="pt-14">
        <Routes>
          <Route path="/" element={<Home />} />
          <Route path="/about" element={<About />} />
          <Route path="/catalog" element={<Catalog />} />
          <Route path="/product/:id" element={<ProductDetail />} />
          <Route path="/cart" element={<CartPage />} />
          <Route path="/payment" element={<Payment />} />
          <Route path="/login" element={<Login />} />
          <Route path="/register" element={<Register />} />
          <Route path="/contact" element={<Contact />} />
          <Route path="/faq" element={<FAQ />} />
          <Route path="/search" element={<Search />} />
          <Route
            path="/checkout"
            element={
              <ProtectedRoute>
                <Checkout />
              </ProtectedRoute>
            }
          />
          <Route path="/checkout-final" element={<CheckoutFinal />} />
          <Route
            path="/account"
            element={
              <ProtectedRoute>
                <Account />
              </ProtectedRoute>
            }
          />

          {/* Rutas admin */}
          
          <Route
            path="/admin/products/:id/edit"
            element={
              <ProtectedRoute role="ADMIN">
                <ProductEditor />
              </ProtectedRoute>
            }
          />
          

          <Route path="*" element={<Navigate to="/" replace />} />
        </Routes>
      </div>
      <Footer />
    </>
  );
}

----- FILE: .\src\main.jsx -----
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import { BrowserRouter } from 'react-router-dom'

import './styles/reset.css'
import './styles/index.css'

import App from './App.jsx'
import { ShopProvider } from './context/ShopContext.jsx'
import { AuthProvider } from './context/AuthContext.jsx'
import { RoleProvider } from './auth/RoleContext.jsx'  // â† agregado

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <BrowserRouter>
      <AuthProvider>
        <ShopProvider>
          <RoleProvider>       {/* â† nuevo provider */}
            <App />
          </RoleProvider>
        </ShopProvider>
      </AuthProvider>
    </BrowserRouter>
  </StrictMode>
)

----- FILE: .\index.html -----
<!doctype html>
<html class="dark" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>String & Soul</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <!-- Tailwind CDN + config -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&display=swap" rel="stylesheet" />
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#b86614",
              "background-light": "#f8f7f6",
              "background-dark": "#211911",
            },
            fontFamily: { display: ["Newsreader"] },
            borderRadius: { DEFAULT: "0.25rem", lg: "0.5rem", xl: "0.75rem", full: "9999px" },
          },
        },
      };
    </script>
    <style>
      .no-scrollbar::-webkit-scrollbar{display:none}
      .no-scrollbar{ -ms-overflow-style:none; scrollbar-width:none }
    </style>
  </head>
  <body class="bg-background-light dark:bg-background-dark font-display text-stone-800 dark:text-stone-200">
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>

